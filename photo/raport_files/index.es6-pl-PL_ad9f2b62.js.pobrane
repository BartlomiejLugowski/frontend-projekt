((e,t)=>{for(var s in t)e[s]=t[s]})(window,(e=>{var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=(e,t,i)=>{s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=(e,t)=>{if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,(t=>e[t]).bind(null,r));return i},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,"a",t),t},s.o=(e,t)=>({}.hasOwnProperty.call(e,t)),s.p="https://assets.allegrostatic.com/sc-12731/",s(s.s=0)})({0(e,t,s){e.exports=s("WdQY")},Jmsw(e){e.exports=JSON.parse('{"a":"https://assets.allegrostatic.com/metrum/icon/arrow-f0934b0f84.svg","b":"https://assets.allegrostatic.com/metrum/icon/x-1a6f095eb2.svg"}')},WdQY(e,t,s){s.r(t);var i=s("rRL6"),r=s.n(i);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const o=e=>"SUGGESTION"===e.type,a=e=>`[data-role="${e}"]`,h=a("advanced-search-criteria"),c=a("filters-dropdown-toggle"),u=a("filters-selected-option"),d=a("multisearch-button"),l=a("multisearch-button-wrapper"),g=a("remove-query"),m=a("remove-recently-searched"),p=a("rewrite-recently-searched"),v=a("search-button"),S=a("search-form"),E=a("search-input"),I=a("suggester"),y=(a("suggestion"),"click"),f="submit";let b=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach(e=>e(...t))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter(e=>e!==t)}});const _={ActiveSuggestionIndex:"activeSuggestionIndex",NextPhrase:"nextPhrase",Suggestions:"suggestions",Tracking:"tracking",InputPhrase:"inputPhrase",SelectedFilterIndex:"selectedFilterIndex",CheckedAdvancedSearchCriteriaIds:"checkedAdvancedSearchCriteriaIds"};class N{constructor(e,t=b()){this.props=e,this.emitter=t,this.state=(({inputPhrase:e,filters:t={list:[],selected:0},advancedSearchCriterias:s=[]})=>{var i;return{activeSuggestionIndex:-1,inputPhrase:e,nextPhrase:e,selectedFilterIndex:null!==(i=t.selected)&&void 0!==i?i:0,suggestions:[],tracking:{},checkedAdvancedSearchCriteriaIds:s.filter(({checked:e})=>e).map(({id:e})=>e)}})(e)}on(...e){return this.emitter.on(...e)}}Object.values(_).forEach(e=>Object.defineProperty(N.prototype,e,{get(){return this.state[e]},set(t){this.state=Object.assign({},this.state,{[e]:t}),this.emitter.emit(e,this.state)}}));const L=e=>!!e&&!!e.type;function k(e,t,s){const i=s.filters.list[t.selectedFilterIndex];return!!L(i)&&e.includes(i.type)}const C=["CHARITY_GOAL_OFFERS"],w=["ENDED","USERS","CHARITY_GOALS","CHARITY_ORGANIZATIONS"];function A(e,t){return k(w,e,t)||!t.advancedSearchCriterias.length}const x=(e,t)=>e.reduce(([e,s],{queryParameter:i,id:r})=>(t.includes(r)?e.push(i):s.push(i),[e,s]),[[],[]]),O=(e,t)=>{t?(e.classList.add("mpof_z0"),e.classList.remove("mpof_5r")):(e.classList.add("mpof_5r"),e.classList.remove("mpof_z0"))},R=(e,t,s,i=!1)=>{(i||e[t]!==s)&&(e[t]=s)},P=(e,t)=>{R(e,_.InputPhrase,t)},T=(e,t)=>{R(e,_.NextPhrase,t,!0)},U=(e,t)=>{R(e,_.CheckedAdvancedSearchCriteriaIds,t)},G=e=>({type:e.type,id:e.id});class j{constructor(e,t,s,i=window){n(this,"previousHash",""),n(this,"stateUnbinders",[]),n(this,"suggesterUnbinders",[]),n(this,"onSuggesterClickSuggestion",e=>{this.sendSuggestHintClickEvent(e)}),n(this,"onSuggesterToggleExpanded",e=>{this.sendSuggestLayerViewEvent(e)}),n(this,"onSuggesterReceivedSuggestions",e=>{this.sendSuggestionsShowEvent(e)}),n(this,"onSuggesterClickRemoveSuggestion",e=>{this.sendSuggestionRemoveClickEvent(e)}),n(this,"onSuggesterClickRewriteSuggestion",e=>{this.sendRewriteClickEvent(e)}),n(this,"sendScopeChangeEvent",({selectedFilterIndex:e})=>{const t={scope:G(this.filtersList[e]),previousScope:G(this.filtersList[this.previousSelectedFilterIndex])};this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"scopeChange",customParams:t}),this.previousSelectedFilterIndex=e}),n(this,"sendSuggestionsShowEvent",e=>{const t=Object.assign({status:e,typedPhrase:this.store.inputPhrase.trim(),suggestions:(s=this.store.suggestions,s.filter(o).reduce((e,t)=>{const s=t.tracking.type;return e.types[s]?e.types[s]+=1:e.types[s]=1,e.count+=1,e},{types:{},count:0})),scope:G(this.filtersList[this.store.selectedFilterIndex])},this.store.tracking);var s;const i=(e=>{const t=this.store.suggestions.filter(o).find(e=>"AD"===e.tracking.type);return t?t.tracking.campaignId:null})();i&&(t.campaignId=i),this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"suggestionsShow",customParams:t}),this.sendAdsDSSSuggestionsShowEvents()}),n(this,"sendAdsDSSSuggestionsShowEvents",()=>{this.store.suggestions.filter(o).filter(e=>"PREMIUMAD"===e.tracking.type).forEach(e=>{const t={analyticsId:e.tracking.emissionUnitId,analyticsEmissionTimestamp:e.tracking.timestamp,analyticsSignature:e.tracking.sig};this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"showDSSItems",customParams:t})})}),n(this,"sendAdvancedSearchCheckedEvent",({checkedAdvancedSearchCriteriaIds:e})=>{const t=(s=e,i=this.previousCheckedAdvancedSearchCriteriaIds,[...s.filter(e=>!i.includes(e)),...i.filter(e=>!s.includes(e))])[0];var s,i;this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"advancedSearchCriteria",value:e.includes(t).toString(),customParams:{id:t}}),this.previousCheckedAdvancedSearchCriteriaIds=[...e]}),this.baseNode=e,this.store=t,this.props=s,this.targetWindow=i,this.searchFormNode=e.querySelector(S),this.searchInputNode=e.querySelector(E),this.searchButtonNode=e.querySelector(v),this.filtersList=s.filters.list,this.previousCheckedAdvancedSearchCriteriaIds=[...t.checkedAdvancedSearchCriteriaIds],this.previousSelectedFilterIndex=this.store.selectedFilterIndex}mount(e){this.addEventListeners(),this.addStateListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeStateListeners(),this.removeSuggesterListeners()}addEventListeners(){this.searchFormNode.addEventListener(f,this),this.searchInputNode.addEventListener("keydown",this),this.searchButtonNode.addEventListener("keydown",this),this.searchButtonNode.addEventListener("mousedown",this)}removeEventListeners(){this.searchFormNode.removeEventListener(f,this),this.searchInputNode.removeEventListener("keydown",this),this.searchButtonNode.removeEventListener("keydown",this),this.searchButtonNode.removeEventListener("mousedown",this)}addStateListeners(){this.stateUnbinders.push(this.store.on(_.SelectedFilterIndex,this.sendScopeChangeEvent),this.store.on(_.CheckedAdvancedSearchCriteriaIds,this.sendAdvancedSearchCheckedEvent))}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on("CLICK_SUGGESTION",this.onSuggesterClickSuggestion),e.on("TOGGLE_IS_EXPANDED",this.onSuggesterToggleExpanded),e.on("RECEIVE_SUGGESTIONS",this.onSuggesterReceivedSuggestions),e.on("CLICK_REMOVE_SUGGESTION",this.onSuggesterClickRemoveSuggestion),e.on("CLICK_REWRITE_SUGGESTION",this.onSuggesterClickRewriteSuggestion))}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}removeSuggesterListeners(){this.suggesterUnbinders.forEach(e=>e())}handleEvent(e){e.type===f&&this.onSubmit(),"keydown"===e.type&&"Enter"===e.key&&this.sendSearchInteraction(e),"mousedown"===e.type&&this.sendSearchInteraction(e)}onSubmit(){if(-1===this.store.activeSuggestionIndex)return;const e=this.store.suggestions.filter(o)[this.store.activeSuggestionIndex];this.sendSuggestHintClickEvent(e)}sendSuggestLayerViewEvent(e){if(!e)return;const t={typedPhrase:this.store.inputPhrase.trim()};this.targetWindow.opbox.analytics.sendItemViewEvent({contextNode:this.searchInputNode,label:"suggestLayerView",customParams:t})}sendSuggestHintClickEvent(e){const t=e.tracking.type+"_REDIRECT",s=Object.assign({typedPhrase:this.store.inputPhrase.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestHintClick",value:t,customParams:s})}sendSearchInteraction(e){var t;const s="keydown"===e.type?"searchEnter":"searchClick",i={typedPhrase:this.store.inputPhrase.trim(),scope:G(null!==(t=this.filtersList[this.store.selectedFilterIndex])&&void 0!==t?t:{})};this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:s,customParams:i})}sendSuggestionRemoveClickEvent(e){const t=e.tracking.type+"_REMOVE",s=Object.assign({typedPhrase:this.store.inputPhrase.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestionRemoveClick",value:t,customParams:s})}sendRewriteClickEvent(e){const t=e.tracking.type+"_REWRITE",s=Object.assign({typedPhrase:this.store.inputPhrase.trim(),details:Object.assign({phrase:e.completionText},e.tracking)},this.store.tracking);this.targetWindow.opbox.analytics.sendBoxInteractionEvent({contextNode:this.searchInputNode,label:"suggestRewriteClick",value:t,customParams:s})}}const $={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;"},D=/<|>|&|"|'/g,B=(RegExp(Array.from("javascript:",e=>e+"[\\n\\r\\t]*").join(""),"ig"),e=>$[e]);class z{constructor(e,t){this.$=e[0];for(let s=0;s<t.length;s++){const i=t[s];if(Array.isArray(i))for(let e=0;e<i.length;e++)this.$esc(i[e]);else this.$esc(i);this.$+=e[s+1]}}$esc(e){this.$+=e instanceof z?e.$:(e+"").replace(D,B)}toString(){return this.$}}var F=(e,...t)=>new z(e,t);const M={"pl-PL":{"Kategoria i opcje wyszukiwania":[["",["Kategoria i opcje wyszukiwania"]]],"Wszystkie kategorie":[["",["Wszystkie kategorie"]]],Zakończone:[["",["Zakończone"]]],Wszędzie:[["",["Wszędzie"]]],Sprzedawcy:[["",["Sprzedawcy"]]],Kategorie:[["",["Kategorie"]]],"Inne opcje":[["",["Inne opcje"]]],"Organizacje charytatywne":[["",["Organizacje charytatywne"]]],"Cele charytatywne":[["",["Cele charytatywne"]]],"czego szukasz?":[["",["czego szukasz?"]]],szukaj:[["",["szukaj"]]],USUŃ:[["",["Usuń podpowiedź z histori"]]],"Cofnij do widoku strony":[["",["Cofnij do widoku strony"]]],"szukaj wielu":[["",["szukaj wielu"]]],Anuluj:[["",["Anuluj"]]],"Dom i Ogród":[["",["Dom i Ogród"]]],Dziecko:[["",["Dziecko"]]],Elektronika:[["",["Elektronika"]]],"Firma i usługi":[["",["Firma i usługi"]]],"Kolekcje i sztuka":[["",["Kolekcje i sztuka"]]],"Kultura i rozrywka":[["",["Kultura i rozrywka"]]],Moda:[["",["Moda"]]],Motoryzacja:[["",["Motoryzacja"]]],Nieruchomości:[["",["Nieruchomości"]]],"Sport i turystyka":[["",["Sport i turystyka"]]],Supermarket:[["",["Supermarket"]]],Uroda:[["",["Uroda"]]],Zdrowie:[["",["Zdrowie"]]]}},W=/({{[^}]+}}|{%[^%}]+%})/g,q=/({{[^}]+}})/g,K=/({%[^%}]+%})/g,H=/({{\s*|\s*}}|{%\s*|\s*%})/g;function Y(e,t=""){if("string"==typeof e)throw Error("Translation has to be an array");return e.find(e=>e[0]===t)[1]}const V=(e,t,s)=>{const i=M["pl-PL"][e];if(!i)throw Error(`Missing translation for lang "pl-PL" and key "${e}"`);return t?((e,t,s)=>{let i=Y(e,t.context);return parseInt(t.count,10)>=0?i=((e,t)=>{const s=1==(i=t)?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;var i;return"boolean"!=typeof s?e[s]:e[s?1:0]})(i,t.count):[i]=i,((e,t,s)=>{if(s){let s=0;return e.split(W).map(i=>{if(i.match(K)){const r=t.formatters[s];if(r)return s+=1,r(i.replace(H,""));throw Error(`Missing translation formatter for "${e}"`)}return i.match(q)?t[i.replace(H,"")]:i})}const i=e.match(W);let r=0;return i?i.reduce((s,i)=>{const n=i.replace(H,"");if(i.match(K)){const o=t.formatters[r];if(o)return r+=1,s.replace(i,o(n));throw Error(`Missing translation formatter for "${e}"`)}return i.match(q)?s.replace(i,t[n]):s},e):e})(i,t,s)})(i,t,s):Y(i)[0]};let Z,J,Q=e=>e;class X{constructor(e,t,s){n(this,"stateUnbinders",[]),this.store=t,this.dropdownToggleNode=e.querySelector(c),this.selectedOptionNode=e.querySelector(u),this.filtersList=s.filters.list}mount(){this.addStateListeners(),this.addEventListeners(),this.updateSelectedFilter(this.dropdownToggleNode)}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.dropdownToggleNode.addEventListener("change",this)}removeEventListeners(){this.dropdownToggleNode.removeEventListener("change",this)}addStateListeners(){this.stateUnbinders.push(this.store.on(_.SelectedFilterIndex,e=>this.handleSelectedFilterIndexChange(e)))}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}handleEvent(e){"change"===e.type&&this.onChange(e)}handleSelectedFilterIndexChange({selectedFilterIndex:e}){var t;const s=null!==(t=this.filtersList[e])&&void 0!==t?t:this.filtersList[0];var i;this.selectedOptionNode.innerHTML=(i=s.name)?V("Wszystkie kategorie")===i?F(Z||(Z=Q`<span class="${0}">${0}</span><span class="${0}">${0}</span>`),"mpof_z0 mpof_5r_x",V("Wszędzie"),"mpof_5r mpof_z0_x",i):F(J||(J=Q`${0}`),i):""}onChange({target:e}){this.updateSelectedFilter(e)}updateSelectedFilter({value:e}){const t=this.filtersList.findIndex(({url:t})=>t===e);var s;s=this.store,R(s,_.SelectedFilterIndex,t)}}const ee={"allegro-pl":"/listing","allegro-cz":"/vyhledavani"},te=["p","us_id","string","description","show-raty0-disclaimer","fromCart"],se=(e,t)=>t.some(t=>{return i=e,(s=t).key===i.key&&s.value===i.value;var s,i}),ie=(e,t)=>se(t,e)?e:[...e,t],re=({key:e,value:t})=>[e,t].map(encodeURIComponent).join("="),ne=({value:e})=>""!==e&&void 0!==e,oe=(e,t=[],s=[])=>{const i=(e.includes(window.location.pathname)&&!Object.values(ee).some(t=>e.includes(t))?(e=>{const t=new URLSearchParams(e);return Array.from(t).filter(([e,t])=>e&&t).map(([e,t])=>({key:e,value:t}))})(window.location.search):[]).filter((r=te,e=>!r.includes(e.key))).concat(t).filter((e=>t=>!se(t,e))(s)).reduce(ie,[]).filter(ne).map(re).join("&");var r;const n=e.includes("?")?"&":"?";return`${e}${i?n:""}${i}`},ae=["ALL","DEPARTMENT","ENDED","USERS"];class he{constructor(e,t,s){n(this,"stateUnbinders",[]),this.baseNode=e,this.store=t,this.props=s,this.searchFormNode=e.querySelector(S),this.multisearchButtonWrapperNode=e.querySelector(l),this.multisearchButtonNode=e.querySelector(d)}mount(){this.addEventListeners(),this.addStateListeners()}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.multisearchButtonNode&&this.multisearchButtonNode.addEventListener(y,this),this.searchFormNode.addEventListener(f,this)}removeEventListeners(){this.multisearchButtonNode&&this.multisearchButtonNode.removeEventListener(y,this),this.searchFormNode.removeEventListener(f,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(_.InputPhrase,e=>this.handleInputPhraseChange(e)))}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}handleEvent(e){e.type===f&&this.onSubmit(e),e.type===y&&this.onMultisearchClick(e)}handleInputPhraseChange({inputPhrase:e}){this.multisearchButtonWrapperNode&&O(this.multisearchButtonWrapperNode,0===e.length)}onMultisearchClick(e){e.preventDefault(),((e,t=window)=>{const{pathname:s,search:i,hash:r}=t.location;e!==r&&(t.history.pushState({previousHash:r},t.document.title,`${s}${i}${e}`),t.dispatchEvent(new HashChangeEvent("hashchange")))})(e.target.hash)}onSubmit(e){var t;e.preventDefault();const s=this.store.inputPhrase.trim(),i=null!==(t=this.props.filters.list[this.store.selectedFilterIndex])&&void 0!==t?t:{};if(!s&&k(ae,this.store,this.props)&&-1===this.store.activeSuggestionIndex)return;const[r,n]=x(this.props.advancedSearchCriterias,this.store.checkedAdvancedSearchCriteriaIds);let a;const h=[...r,...this.props.staticQueryParameters],c=n;-1!==this.store.activeSuggestionIndex?({url:a}=this.store.suggestions.filter(o)[this.store.activeSuggestionIndex]):i.url?"USERS"===i.type?a=`${i.url}/${s}`:(a=i.url,h.unshift({key:"string",value:s})):(a=this.props.listingPathname,h.unshift({key:"string",value:s}));const u=oe(a,h,c);window.document.location.assign(u)}}class ce{constructor(e,t,s=b(),i=window){n(this,"stateUnbinders",[]),n(this,"suggesterUnbinders",[]),n(this,"onStateInputPhrase",({inputPhrase:e})=>{this.clearInputButtonNode&&O(this.clearInputButtonNode,!!e)}),n(this,"onStateNextPhrase",({nextPhrase:e})=>{this.updateSearchInputValue(e)}),n(this,"onSuggesterClickSuggestionActionIcon",()=>{this.focusNode()}),n(this,"focusNode",()=>{this.searchInputNode.focus()}),n(this,"blurNode",()=>{this.searchInputNode.blur()}),n(this,"onClearInputClick",()=>{this.focusNode(),this.updateSearchInputValue(""),this.emitter.emit("CLEAR")}),n(this,"handleOnKeydown",e=>{const t={ArrowDown:this.onArrowDownPressAndEmit,ArrowUp:this.onArrowUpPressAndEmit,Escape:this.onEscapePressAndEmit,Delete:this.emitOnDeletePress,Tab:this.emitOnTabPress}[e.key];t&&t(e)}),n(this,"emitOnInput",e=>this.emitter.emit("INPUT",e)),n(this,"onBlurAndEmit",()=>{this.emitter.emit("BLUR")}),n(this,"emitOnClick",()=>this.emitter.emit("CLICK")),n(this,"onArrowDownPressAndEmit",e=>{e.preventDefault(),this.emitter.emit("KEY_ARROW_DOWN")}),n(this,"onArrowUpPressAndEmit",e=>{e.preventDefault(),this.emitter.emit("KEY_ARROW_UP")}),n(this,"emitOnTabPress",()=>this.emitter.emit("KEY_TAB")),n(this,"emitOnDeletePress",()=>this.emitter.emit("KEY_DELETE")),n(this,"onEscapePressAndEmit",()=>{this.updateSearchInputValue(""),this.emitter.emit("KEY_ESCAPE")}),this.baseNode=e,this.store=t,this.emitter=s,this.targetWindow=i,this.searchInputNode=e.querySelector(E),this.clearInputButtonNode=e.querySelector(g)}mount(e){this.addEventListeners(),this.addGlobalEventListeners(),this.addStateListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeGlobalEventListeners(),this.removeStateListeners(),this.removeSuggesterListeners()}onUpdate({inputPhrase:e=""}){this.updateSearchInputValue(e)}addEventListeners(){this.searchInputNode.addEventListener("blur",this),this.searchInputNode.addEventListener(y,this),this.searchInputNode.addEventListener("input",this),this.searchInputNode.addEventListener("keydown",this),this.searchInputNode.addEventListener("focus",this),this.clearInputButtonNode&&this.clearInputButtonNode.addEventListener(y,this)}addGlobalEventListeners(){this.targetWindow.addEventListener("touchmove",this,!0)}addStateListeners(){this.stateUnbinders.push(this.store.on(_.InputPhrase,this.onStateInputPhrase),this.store.on(_.NextPhrase,this.onStateNextPhrase))}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on("CLICK_REMOVE_SUGGESTION",this.onSuggesterClickSuggestionActionIcon),e.on("CLICK_REWRITE_SUGGESTION",this.onSuggesterClickSuggestionActionIcon))}removeEventListeners(){this.searchInputNode.removeEventListener("blur",this),this.searchInputNode.removeEventListener(y,this),this.searchInputNode.removeEventListener("input",this),this.searchInputNode.removeEventListener("keydown",this),this.searchInputNode.removeEventListener("focus",this),this.clearInputButtonNode&&this.clearInputButtonNode.removeEventListener(y,this)}removeGlobalEventListeners(){this.targetWindow.removeEventListener("touchmove",this)}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}removeSuggesterListeners(){this.suggesterUnbinders.forEach(e=>e())}handleEvent(e){const{type:t,currentTarget:s}=e;if("blur"===t&&this.onBlurAndEmit(),t===y&&(s===this.searchInputNode&&this.emitOnClick(),s===this.clearInputButtonNode&&this.onClearInputClick()),"input"===t){const e=s.value.trim();this.emitOnInput(e),P(this.store,e)}"keydown"===t&&this.handleOnKeydown(e),"touchmove"===t&&this.blurNode()}updateSearchInputValue(e){this.searchInputNode.value=e,P(this.store,e)}}let ue,de,le,ge,me=e=>e,pe=e=>e;function ve(e,t){return A(t,e)?[]:[t.suggestions.length?F(ue||(ue=me`<hr class="${0}" />`),"vmcnm"):"",e.advancedSearchCriterias.map(e=>(({id:e,label:t,badge:s},i)=>F(le||(le=pe`<div data-role="${0}" class="${0}"><input type="checkbox" autocomplete="off" id="${0}" class="${0}" ${0} /><label for="${0}" class="${0}">${0} ${0}</label></div>`),"advanced-search-criteria","searchInDescriptionChange"===e?"mpof_5r mpof_z0_s":"",e,"ch16hq ch1iux cht1i8",i.checkedAdvancedSearchCriteriaIds.includes(e)?F(ge||(ge=pe`checked`)):"",e,"ch1pig munh_16",t,(e=>{if(!e)return"";const{textColor:t,backgroundColor:s,text:i}=e;return F(de||(de=pe`<span class="${0}" style="color: ${0}; background-color: ${0};">${0}</span>`),"msbw_2 mldj_2 mtag_2 mm2b_2 mvrt_4 mh36_4 mqu1_16 mgmw_9u msa3_z4 mj9z_5r mp0t_ji mgn2_12 mg9e_2 mj7a_2",t,s,i)})(s)))(e,t))]}function Se(e){var t,s,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(s=Se(e[t]))&&(i&&(i+=" "),i+=s);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}var Ee=function(){for(var e,t,s=0,i="";s<arguments.length;)(e=arguments[s++])&&(t=Se(e))&&(i&&(i+=" "),i+=t);return i},Ie="mp7g_f6 mnjl_0 mg9e_0 mvrt_0 mj7a_0 mh36_0 m9tr_5r mq1m_0 mqm6_0 mp4t_56 mryx_56 _535b5_eeYlJ";let ye,fe,be,_e,Ne=e=>e;function Le(e){switch(e.size){case"SMALL":return"mgn2_12 mqu1_16";case"MEDIUM":default:return"mgn2_14 mqu1_21"}}function ke(e){return"IMAGE"===e.type?((e,...t)=>F(be||(be=Ne`<span data-type="IMAGE" class="${0}">${0}</span>`),Ee("_535b5_J8Mvg",t),F(_e||(_e=Ne`<img src="${0}" alt="">`),e.url)))(e,Le(e)):((e,...t)=>F(ye||(ye=Ne`<span data-type="${0}" class="${0}">${0}</span>`),e.style,Ee("_535b5_J8Mvg",t),F(fe||(fe=Ne`${0}`),e.text)))(e,(e=>{switch(e.style){case"STRONG":return"m9qz_yq";case"PRIMARY":return"mgmw_s9";case"SECONDARY":return"mgmw_3z";case"NORMAL":default:return""}})(e),Le(e))}let Ce,we=e=>e;function Ae({buttonClassName:e,iconClassName:t,icon:s,dataRole:i}){return F(Ce||(Ce=we`<button tabindex="-1" aria-hidden="true" type="button" class="${0}" data-role="${0}"><img class="${0}" src="${0}" alt="" /></button>`),Ee("b1vwg",e),i,Ee("mjyo_6x meqh_en msa3_z4 m0s5_e6 mg9e_8 mvrt_8 mj7a_8 mh36_8 mhd5_0m mupj_mm mse2_40 m7er_40 _535b5_0xStM",t),s)}var xe=s("Jmsw");let Oe,Re,Pe,Te,Ue=e=>e;class Ge{constructor(e,t,s){n(this,"stateUnbinders",[]),n(this,"onCheckedAdvancedSearchCriteriaIds",({checkedAdvancedSearchCriteriaIds:e})=>{this.inputElement.checked=e.includes(this.item.id)}),this.baseNode=e,this.item=t,this.store=s,this.inputElement=e.querySelector("input"),this.labelElement=e.querySelector("label")}mount(){this.addEventListeners(),this.addStateListeners()}unmount(){this.removeEventListeners(),this.removeStateListeners()}addEventListeners(){this.labelElement.addEventListener(y,this)}addStateListeners(){this.stateUnbinders.push(this.store.on(_.CheckedAdvancedSearchCriteriaIds,this.onCheckedAdvancedSearchCriteriaIds))}removeEventListeners(){this.labelElement.removeEventListener(y,this)}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}handleEvent(e){e.type===y&&this.onClick(e)}onClick(e){e.preventDefault();const{checkedAdvancedSearchCriteriaIds:t}=this.store,s=this.inputElement.checked?t.filter(e=>e!==this.item.id):[...t,this.item.id];U(this.store,s)}}const je=()=>window.opbox.edge;class $e{constructor(e,t,s,i){this.anchorNode=e,this.store=t,this.suggestion=s,this.emitter=i,this.rewriteButtonNode=e.querySelector(p),this.removeButtonNode=e.querySelector(m)}mount(){this.addEventListeners()}unmount(){this.removeEventListeners()}addEventListeners(){this.anchorNode.addEventListener(y,this),this.removeButtonNode&&this.removeButtonNode.addEventListener(y,this),this.rewriteButtonNode&&this.rewriteButtonNode.addEventListener(y,this)}removeEventListeners(){this.anchorNode.removeEventListener(y,this),this.removeButtonNode&&this.removeButtonNode.removeEventListener(y,this),this.rewriteButtonNode&&this.rewriteButtonNode.removeEventListener(y,this)}handleEvent(e){e.preventDefault(),e.stopPropagation(),e.currentTarget===this.anchorNode&&this.onItemClick(),e.currentTarget===this.removeButtonNode&&this.onRemoveButtonClick(),e.currentTarget===this.rewriteButtonNode&&this.onRewriteButtonClick()}onItemClick(){this.emitter.emit("CLICK_SUGGESTION",this.suggestion)}onRemoveButtonClick(){this.emitter.emit("CLICK_REMOVE_SUGGESTION",this.suggestion)}onRewriteButtonClick(){this.emitter.emit("CLICK_REWRITE_SUGGESTION",this.suggestion)}markActive(){this.anchorNode.setAttribute("aria-selected","true"),T(this.store,this.suggestion.completionText||"")}markInactive(){this.anchorNode.removeAttribute("aria-selected")}}const De=["CATEGORY","DEPARTMENT","ENDED","USER_NAME","CHARITY_ORGANIZATION"],Be=["CATEGORY","DEPARTMENT","CHARITY_ORGANIZATION"],ze=["USER_NAME"],Fe=["USERS","CHARITY_GOALS","CHARITY_ORGANIZATION","CHARITY_ORGANIZATIONS"];function Me(e){switch(e){case"USERS":return"sellers";case"CHARITY_ORGANIZATIONS":return"charity-organizations";case"CHARITY_GOALS":case"CHARITY_ORGANIZATION":return"fundraising-campaigns";default:return"all"}}class We{constructor(e,t,s,i,r=b(),a=window){var h=this;n(this,"isExpanded",!1),n(this,"suggestionItems",[]),n(this,"advancedSearchCriteriaItems",[]),n(this,"stateUnbinders",[]),n(this,"suggesterUnbinders",[]),n(this,"searchInputUnbinders",[]),n(this,"onStateSuggestions",()=>{this.render()}),n(this,"onSearchInputBlur",()=>{this.store.activeSuggestionIndex=-1}),n(this,"onSearchInputClear",()=>{this.fetch()}),n(this,"onSearchInputClick",()=>{this.isExpanded||this.fetch()}),n(this,"onSearchInput",e=>{this.fetch(e)}),n(this,"onSearchInputTabPress",()=>{this.destroy()}),n(this,"onSearchInputEscapePress",()=>{this.destroy()}),n(this,"onSearchInputArrowUpPress",()=>{this.markPreviousSuggestion()}),n(this,"onSearchInputArrowDownPress",()=>{this.markNextSuggestion()}),n(this,"onSearchInputDeletePress",()=>{if(-1===this.store.activeSuggestionIndex)return;const e=this.store.suggestions.filter(o)[this.store.activeSuggestionIndex];this.deleteSuggestion(e)}),n(this,"fetch",async(e=h.store.inputPhrase)=>k(C,h.store,h.props)||((e,t)=>!t.enableSuggestionsForEmptyPhrase&&(e=>""===e)(e))(e,h.props)?Promise.resolve():((e,t=je())=>t.get("/search-suggester/suggestions?"+Object.entries(e).map(([e,t])=>re({key:e,value:t})).join("&"),{withCredentials:!0,cancelLast:!0,headers:{accept:"application/vnd.allegro.internal.v7+json"}}))(Object.assign({query:e},h.props.enableSuggesterHistory?{history:!0}:{},((e,t)=>{const s=t.filters.list[e.selectedFilterIndex];if(!L(s))return{};const{type:i,id:r,name:n}=s,o=De.includes(i),a=Be.includes(i),h=ze.includes(i),c=Fe.includes(i);let u;switch(i){case"CHARITY_ORGANIZATION":u="charity-organization";break;case"DEPARTMENT":u="category";break;default:u=i.toLowerCase()}return Object.assign({},o?{scope:u}:{},a?{"scope-value":r}:{},h?{"scope-value":n}:{},c?{types:Me(i)}:{})})(h.store,h.props))).then(({status:e,data:{suggestions:t,tracking:s}})=>{h.store.tracking=s,h.store.suggestions=t,h.store.activeSuggestionIndex=-1,h.emitter.emit("RECEIVE_SUGGESTIONS",e)}).catch(e=>{e&&0===e.status||(h.store.tracking={},h.store.suggestions=[],h.store.activeSuggestionIndex=-1,h.emitter.emit("RECEIVE_SUGGESTIONS",e&&e.status||e))})),n(this,"onToggleExpanded",e=>{this.isExpanded=e}),n(this,"onClickSuggestion",e=>{const[t,s]=x(this.props.advancedSearchCriterias,this.store.checkedAdvancedSearchCriteriaIds),i=[...t,...this.props.staticQueryParameters],r=oe(e.url,i,s);this.targetWindow.document.location.assign(r)}),n(this,"onClickRewriteSuggestion",e=>{this.fetch(e.completionText),T(this.store,e.completionText||"")}),n(this,"onClickRemoveSuggestion",e=>{this.deleteSuggestion(e)}),n(this,"deleteSuggestion",({history:{removable:e,id:t}})=>{e&&t&&((e,t=je())=>t.delete("/search-history/"+e,{withCredentials:!0,disableDefaultHeaders:!0}))(t).then(({status:e})=>{e>=200&&e<300&&this.fetch()}).catch(Function.prototype)}),this.baseNode=e,this.store=t,this.props=s,this.searchInput=i,this.emitter=r,this.targetWindow=a,this.suggesterNode=e.querySelector(I),this.mainWrapper=a.document.body.querySelector(".main-wrapper")}mount(){this.addStateListeners(),this.addSuggesterListeners(),this.addSearchInputListeners(),this.addGlobalEventListeners()}unmount(){this.removeStateListeners(),this.removeSuggesterListeners(),this.removeSearchInputListeners(),this.removeGlobalEventListeners()}onUpdate({inputPhrase:e="",advancedSearchCriterias:t=[]}){""===e&&this.destroy(),U(this.store,t.filter(({checked:e})=>e).map(({id:e})=>e))}addStateListeners(){this.stateUnbinders.push(this.store.on(_.Suggestions,this.onStateSuggestions))}addSuggesterListeners(){this.suggesterUnbinders.push(this.emitter.on("TOGGLE_IS_EXPANDED",this.onToggleExpanded),this.emitter.on("CLICK_SUGGESTION",this.onClickSuggestion),this.emitter.on("CLICK_REWRITE_SUGGESTION",this.onClickRewriteSuggestion),this.emitter.on("CLICK_REMOVE_SUGGESTION",this.onClickRemoveSuggestion))}addSearchInputListeners(){this.searchInputUnbinders.push(this.searchInput.emitter.on("BLUR",this.onSearchInputBlur),this.searchInput.emitter.on("CLEAR",this.onSearchInputClear),this.searchInput.emitter.on("CLICK",this.onSearchInputClick),this.searchInput.emitter.on("INPUT",this.onSearchInput),this.searchInput.emitter.on("KEY_TAB",this.onSearchInputTabPress),this.searchInput.emitter.on("KEY_ESCAPE",this.onSearchInputEscapePress),this.searchInput.emitter.on("KEY_ARROW_UP",this.onSearchInputArrowUpPress),this.searchInput.emitter.on("KEY_ARROW_DOWN",this.onSearchInputArrowDownPress),this.searchInput.emitter.on("KEY_DELETE",this.onSearchInputDeletePress))}addGlobalEventListeners(){this.targetWindow.addEventListener(y,this)}removeGlobalEventListeners(){this.targetWindow.removeEventListener(y,this)}removeStateListeners(){this.stateUnbinders.forEach(e=>e())}removeSuggesterListeners(){this.suggesterUnbinders.forEach(e=>e())}removeSearchInputListeners(){this.searchInputUnbinders.forEach(e=>e())}handleEvent(e){e.type===y&&this.onGlobalClick(e)}render(){var e,t;this.unmountSuggestions(),this.unmountAdvancedSearchCriteria(),this.suggesterNode.innerHTML=(e=this.props,t=this.store,((e,t=",")=>e.length?new z(["",...Array(e.length-1).fill(t),""],e):"")([...t.suggestions.map(t=>((e,t)=>{switch(e.type){case"LABEL":return(({view:{labelItems:e}})=>F(Oe||(Oe=Ue`<div data-role="${0}" class="${0}"><div class="${0}">${0}</div></div>`),"label","mjyo_lo mp7g_oh mpof_ki mg9e_8 mj7a_8 mvrt_16 mh36_8 mj9z_5r mgmw_wo","meqh_en m7er_k4 mqu1_1 _535b5_cr-H6",e.map(ke)))(e);case"SUGGESTION":return((e,t)=>{const{url:s,view:i}=e,{image:r}=i,n=!!r,o=n&&"AUTO"!==r.size,a=n&&"LARGE"===r.size?"_535b5_70jzr":"_535b5_5HBqT",h=e=>e.length?F(Re||(Re=Ue`<div class="${0}">${0}</div>`),"mqu1_1",e.map(ke)):"",c=n?F(Pe||(Pe=Ue`<img alt="" src="${0}" class="${0}" />`),r.url,Ee("m3h2_8",{[a]:o})):"";return F(Te||(Te=Ue`<a role="option" href="${0}" class="${0}" data-role="${0}">${0} ${0}<div class="${0}">${0} ${0}</div></a>`),s,Ee("mjyo_lo mp7g_oh mpof_ki mg9e_8 mj7a_8 mvrt_16 mh36_8 mj9z_5r mgmw_wo _535b5_iaSxk","mjyo_lo mp7g_oh mpof_ki mvrt_16 mh36_8 mj9z_5r mgmw_wo m389_6m mg9e_4 mj7a_4 _535b5_cqyNy"),"suggestion",c,(({history:e,completionText:t},s)=>{return e.removable?(i=s.enableSuggestionRemovalButtonOnHover,Ae({icon:xe.b,buttonClassName:Ee(Ie,i&&"mpof_5r _535b5_EG11e"),dataRole:"remove-recently-searched"})):t&&s.enableRewriteSuggestionButton?Ae({icon:xe.a,iconClassName:"_535b5_5wzhr",buttonClassName:Ie,dataRole:"rewrite-recently-searched"}):"";var i})(e,t),"m7er_k4 _535b5_sl1f0",h(i.labelItems),i.subLabelItems?h(i.subLabelItems):"")})(e,t);default:return""}})(t,e)),...ve(e,t)],"")).toString(),this.mountSuggestions(),this.mountAdvancedSearchCriteria(),this.markSuggesterAccordingly()}destroy(){this.unmountSuggestions(),this.unmountAdvancedSearchCriteria(),this.markSuggesterInactive(),this.suggesterNode.innerHTML=""}markSuggestionByStepOf(e){const{length:t}=this.suggestionItems;if(0===t)return;const{activeSuggestionIndex:s}=this.store,i=((Math.max(s,1===e?-1:0)+e)%t+t)%t;var r;this.toggleActiveSuggestions(s,i),r=this.store,R(r,_.ActiveSuggestionIndex,i)}markPreviousSuggestion(){this.markSuggestionByStepOf(-1)}markNextSuggestion(){this.markSuggestionByStepOf(1)}toggleActiveSuggestions(e,t){-1!==e&&this.suggestionItems[e].markInactive(),this.suggestionItems[t].markActive()}mountSuggestions(){const e=this.suggesterNode.childNodes;Array.from(e).filter(e=>"A"===e.nodeName).forEach((e,t)=>{const s=this.store.suggestions.filter(o)[t],i=new $e(e,this.store,s,this.emitter);i.mount(),this.suggestionItems.push(i)})}mountAdvancedSearchCriteria(){this.suggesterNode.querySelectorAll(h).forEach((e,t)=>{const s=new Ge(e,this.props.advancedSearchCriterias[t],this.store);s.mount(),this.advancedSearchCriteriaItems.push(s)})}unmountSuggestions(){this.suggestionItems.forEach(e=>e.unmount()),this.suggestionItems=[]}unmountAdvancedSearchCriteria(){this.advancedSearchCriteriaItems.forEach(e=>e.unmount()),this.advancedSearchCriteriaItems=[]}markSuggesterAccordingly(){0===this.store.suggestions.length&&A(this.store,this.props)?this.markSuggesterInactive():this.isExpanded||this.markSuggesterActive()}markSuggesterActive(){this.suggesterNode.setAttribute("aria-expanded","true"),this.emitter.emit("TOGGLE_IS_EXPANDED",!0)}markSuggesterInactive(){this.suggesterNode.setAttribute("aria-expanded","false"),this.emitter.emit("TOGGLE_IS_EXPANDED",!1)}onGlobalClick(e){this.isExpanded&&null===e.target.closest([I,E,g,v].join(","))&&this.destroy()}}class qe{constructor(e,t,s,i=window.localStorage){n(this,"suggesterUnbinders",[]),n(this,"onSubmit",()=>{const{activeSuggestionIndex:e,suggestions:t}=this.store;if(-1===e)this.saveEntryFromStore();else{const s=t.filter(o)[e];this.saveEntryFromSuggestion(s)}}),n(this,"onSuggesterClickSuggestion",e=>{this.saveEntryFromSuggestion(e)}),n(this,"getFilterScopeData",()=>{const e=this.props.filters.list[this.store.selectedFilterIndex];return{scope:"DEPARTMENT"===e.type?"CATEGORY":e.type,scopeValue:"USER_NAME"===e.type?e.name:e.id}}),n(this,"saveEntryFromSuggestion",e=>{const{action:t}=e;if(!e.history.save||!t)return;const s=Object.assign({action:t,userQuery:null,id:e.history.id},this.getFilterScopeData());this.saveEntry(s)}),this.baseNode=e,this.store=t,this.props=s,this.localStorage=i,this.searchFormNode=e.querySelector(S)}mount(e){this.postHistoryEntry(),this.addEventListeners(),this.addSuggesterListeners(e)}unmount(){this.removeEventListeners(),this.removeSuggesterListeners()}addSuggesterListeners(e){this.suggesterUnbinders.push(e.on("CLICK_SUGGESTION",this.onSuggesterClickSuggestion))}addEventListeners(){this.searchFormNode.addEventListener(f,this)}removeSuggesterListeners(){this.suggesterUnbinders.forEach(e=>e())}removeEventListeners(){this.searchFormNode.removeEventListener(f,this)}handleEvent(e){e.type===f&&this.onSubmit()}saveEntryFromStore(){const e=Object.assign({userQuery:this.store.inputPhrase},this.getFilterScopeData());this.saveEntry(e)}saveEntry(e){e.scope&&(e.action||e.userQuery)&&this.localStorage.setItem("opbox-search-history",JSON.stringify(e))}getEntry(){return JSON.parse(this.localStorage.getItem("opbox-search-history")||"null")}removeEntry(){this.localStorage.removeItem("opbox-search-history")}postHistoryEntry(){const e=this.getEntry();e&&((e,t=je())=>t.post("/search-history",e,{withCredentials:!0,headers:{"content-type":"application/vnd.allegro.internal.v2+json"}}))(e).then(()=>this.removeEntry())}}window.opbox.component.register({prototypeName:"allegro.metrumHeader.search",clientImplementationVersion:r.a},class{constructor({baseNode:e,props:t}){n(this,"onUpdate",e=>{this.searchInput.onUpdate(e),this.suggester.onUpdate(e)}),this.baseNode=e,this.props=t,this.store=new N(t),this.searchInput=new ce(e,this.store),this.searchForm=new he(e,this.store,t),this.suggester=new We(e,this.store,t,this.searchInput),this.filters=new X(e,this.store,t),t.enableSuggesterHistory&&(this.history=new qe(e,this.store,t)),this.analyticsDispatcher=new j(e,this.store,t)}onMount(){this.analyticsDispatcher.mount(this.suggester.emitter),this.props.enableSuggesterHistory&&this.history.mount(this.suggester.emitter),this.searchInput.mount(this.suggester.emitter),this.searchForm.mount(),this.filters.mount(),this.suggester.mount()}onUnmount(){this.analyticsDispatcher.unmount(),this.props.enableSuggesterHistory&&this.history.unmount(),this.searchInput.unmount(),this.searchForm.unmount(),this.filters.unmount(),this.suggester.unmount()}})},rRL6(e,t){e.exports="e5e"}}));
//# sourceMappingURL=index.es6-pl-PL_ad9f2b62.js.map