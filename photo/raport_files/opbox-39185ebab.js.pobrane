var attach=function(e){function t(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new k(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return S()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var v={};c(v,i,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(P([])));g&&g!==n&&r.call(g,i)&&(v=g);var y=p.prototype=h.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(o,i,a,s){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function E(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=p,c(y,"constructor",p),c(p,"constructor",f),f.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(w.prototype),c(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new w(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(y),c(y,s,"Generator"),c(y,i,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,n){return d=l()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&u(o,n.prototype),o},d.apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return d(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},h(e)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b="/metrum/",w=Object.assign,E=Object.values,C=Object.keys,x=Object.entries,k=Array.from;function P(e){return[].slice.call(e)}var S=JSON.parse,I=JSON.stringify;function N(e){return Array.isArray(e)}function A(e){return n(e)}function O(e){return"object"===A(e)&&!N(e)&&null!==e}function R(e){return"string"===A(e)}function T(e){return"undefined"===A(e)}function M(e){return"function"===A(e)}function V(e){return null===e||"object"!==A(e)||0===C(e).length}function j(e,t,n){return e?k(e.querySelectorAll(t),n):[]}function L(e,t){return e?e.querySelector(t):null}function B(e,t){return e.hasAttribute(t)}function W(e,t){return e?e.getAttribute(t):null}function U(e){return W(e,"data-prototype-id")}function H(e){return W(e,"data-box-id")}function F(e){return W(e,"data-box-name")}function _(e){return W(e,"data-civ")}function z(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return w.apply(void 0,[e.createElement(t)].concat(r))}function D(e,t){return e.insertAdjacentElement("afterend",t)}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes(b)}function G(e){return R(e)?e.split(b)[1].split("/")[0].replace("metrum-",""):""}function Y(){}function J(e,t,n){var r;return function(){for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];var s=this,c=function(){r=null,n||e.apply(s,i)},u=n&&!r;return clearTimeout(r),r=setTimeout(c,t),u&&e.apply(s,i),r}}function X(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new CustomEvent(t,Object.assign({bubbles:!1,cancelable:!0},n));e.dispatchEvent(r)}function K(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if(0===r.length)return e=t;var i=r,a=i.shift();return(e="object"!==A(e)?{}:e)[a]=K.apply(void 0,[e[a],t].concat(i)),e}function Q(e,t){return C(e).reduce((function(n,r){var o=e[r],i="object"===A(o)?Q(o,t):o;return n[t.find((function(e){return r.toLowerCase()===e.toLowerCase()}))||r]=i,n}),{})}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1};C(e).forEach((function(n){Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])&&delete e[n]}))}var Z=/Version\/[\d.]+.*Safari/,ee=/iPhone|iPad|iPod|Android/i;var te=function(e){return function(t,n){return Object.assign({},t,e(n))}},ne=function(e,t,n){return e.addEventListener(t,n)},re=function(){return Date.now()};function oe(e){return"noModule"in z(e.document,"script")}function ie(e,t){"loading"===e.readyState?ne(e,"DOMContentLoaded",t):t()}function ae(e){return e.textContent}var se=function(e,t,n,r,o,i,a){var s=new XMLHttpRequest;return s.open(e,t,!0),C(r).forEach((function(e){s.setRequestHeader(e,r[e])})),s.withCredentials=o,s.responseType=a,s.upload&&i&&ne(s.upload,"progress",i),s.send(function(e,t){return["POST","PUT","PATCH"].includes(e)?"object"!==A(t)||t instanceof Blob||t instanceof FormData?t:I(t):null}(e,n)),s},ce=function(e){return e>=200&&e<=204},ue=function(e,t,n,r){var o=e.status,i=e.response,a=e.responseType,s=t(o),c=function(e){return e.split("\n").reduce((function(e,t){var n=t.indexOf(":"),r=t.substr(0,n).trim().toLowerCase(),o=t.substr(n+1).trim();return r&&(e[r]=e[r]?"".concat(e[r],", ").concat(o):o),e}),{})}(e.getAllResponseHeaders()),u={};if("blob"===a)u=i;else{var l=e.responseText;try{u=S(l)}catch(e){u=l}}s?n({status:o,data:u,headers:c}):r({status:o,data:u,message:"Request failed with status code ".concat(o),headers:c})},le=function(){var e=null,t=function(t,n,r,o){var i=o.headers,a=void 0===i?{}:i,s=o.validateStatus,c=void 0===s?ce:s,u=o.withCredentials,l=void 0!==u&&u,d=o.cancelLast,h=void 0!==d&&d,f=o.onUploadProgress,p=o.responseType,v=void 0===p?"":p;h&&null!==e&&e.abort();var m=se(t,n,r,a,l,f,v);return e=m,function(e,t){return new Promise((function(n,r){e.readyState===XMLHttpRequest.DONE?ue(e,t,n,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(ue(e,t,n,r),e.onreadystatechange=null)}}))}(m,c).finally((function(){e=null}))};return{request:t,get:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("GET",e,{},n)},post:function(e,n,r){return t("POST",e,n,r)},put:function(e,n,r){return t("PUT",e,n,r)},patch:function(e,n,r){return t("PATCH",e,n,r)},delete:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("DELETE",e,{},n)}}},de=function(e){return e.opbox||{}},he=function(e,t){e.opbox=e.opbox||{},C(t).forEach((function(n){e.opbox[n]=t[n]}))},fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.targetWindow;o(this,e),this.targetWindow=n}return a(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}(),pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(i,e);var t,n,r=(t=i,n=l(),function(){var e,r=c(t);if(n){var o=c(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return p(this,e)});function i(e){var t;return o(this,i),(t=r.call(this,e)).message=e,t.name="PageRenderingError",t}return a(i)}(h(Error)),ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.data,r=t.headers;o(this,e),this.data=n,this.headers=r}return a(e,[{key:"valid",get:function(){return O(this.data)}}]),e}(),me=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.dataSources=t}return a(e,[{key:"resolve",value:function(e,t){var n=e.value;if("DATA_SOURCE"===e.type){var r=this.dataSources[n];return Object.assign({},r&&r.data&&s({},t,r.data),r&&!V(r.metadata)&&s({},"".concat(t,".$meta"),r.metadata))}return s({},t,n)}}]),e}(),ge=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxes,r=void 0===n?{}:n,i=t.boxNameToIdMap,a=void 0===i?{}:i,s=t.dataSources,c=void 0===s?{}:s,u=t.meta,l=void 0===u?{}:u;o(this,e),this.boxes=r,this.boxNameToIdMap=a,this.dataSources=c,this.meta=l,this.parameterResolver=new me(c)}return a(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this,t=this.pageProperties;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return C(e).forEach((function(o){r[o]=t.call(n,e[o],o,e)})),r}(this.boxes,(function(n){var r=C(n).reduce((function(t,r){var o=e.parameterResolver.resolve(n[r],r);return w(t,o)}),{});return w(r,t)}))}},{key:"pageProperties",get:function(){var e={};for(var t in this.meta)0===t.indexOf("$page.")&&(e[t]=this.meta[t]);return e}}]),e}();function ye(e,t){var n=new URLSearchParams(e.search);return x(t).map((function(e){var t=v(e,2),r=t[0],o=t[1];return N(o)?(n.delete(r),o.forEach((function(e){return n.append(r,e)}))):n.set(r,o),n})),n}function be(e){var t=e.href,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL(t);return r.search=ye(r,n).toString(),r.toString()}var we="application/vnd.opbox-web.subtree+json";function Ee(e){return e>=200&&e<300||502===e}function Ce(e){return!!e.match(new RegExp("^(\\/[a-zA-Z0-9\\-]+)*\\/{0,1}$"))}var xe=function(){function e(t){var n=this,r=t.targetWindow,i=void 0===r?window:r,a=t.config,c=void 0===a?{}:a,u=t.httpClient,l=t.reportError,d=t.fragmentRenderCallback,h=t.boxRenderCallback;o(this,e),s(this,"updateViewId",(function(e){n.viewId=e})),s(this,"renderSubtree",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.boxId,r=e.additionalQueryParameters,o=void 0===r?{}:r,i=e.isPlaceholder,a=void 0!==i&&i;return n.targetWindow.console.warn("Warning: renderSubtree method is deprecated and will be removed soon. Use render.box method instead."),n.renderBox({boxId:t,additionalQueryParameters:o,isPlaceholder:a})})),this.httpClient=u,this.reportError=l,this.targetWindow=i,this.fragmentRenderCallback=d,this.boxRenderCallback=h,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this)},this.viewId=c.viewId}return a(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:Ee};return this.httpClient.get(e,t).then((function(e){var t=new ve(e);if(!t.valid)throw new pe("Opbox response is invalid.");return new ge(t.data)}))}},{key:"handleError",value:function(e){return this.reportError(new Error(e)),Promise.reject(e)}},{key:"renderBox",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxId,r=t.additionalQueryParameters,o=void 0===r?{}:r,i=t.isPlaceholder,a=void 0!==i&&i;return n?this.httpClient.get(be(this.targetWindow.location,o),{headers:{Accept:we,"x-box-id":n,"x-view-id":this.viewId},cancelLast:!1,validateStatus:Ee}).then((function(t){var r=t.data;return e.boxRenderCallback({boxId:n,data:r,isPlaceholder:a})})):this.handleError("Missing 'boxId' property!")}},{key:"renderFragment",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pathname,r=t.additionalQueryParameters,o=void 0===r?{}:r;if(!n)return this.handleError("Missing 'pathname' property!");if(!Ce(n))return this.handleError("Invalid 'pathname' property!");var i=this.targetWindow.location,a=i.protocol,s=i.host,c=new URL("".concat(a,"//").concat(s).concat(n)),u=c.href;return this.httpClient.get(be({href:u},o),{headers:{Accept:we,"x-view-id":this.viewId},cancelLast:!1,validateStatus:Ee}).then((function(t){var r=t.data;return e.fragmentRenderCallback({pathname:n,data:r})}))}},{key:"createAPI",value:function(){return{renderSubtree:this.renderSubtree,render:this.render}}}]),e}(),ke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.meta,r=void 0===n?{}:n,i=arguments.length>1?arguments[1]:void 0;o(this,e),this.appContext=i,this.meta=r}return a(e,[{key:"updateMetaRobots",value:function(){var e=L(this.appContext.document,'head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),Pe=function(){function e(t){var n=this,r=t.appContext,i=t.analytics,a=t.updateViewIdCallback,c=t.updateComponentCallback,u=void 0===c?Y:c,l=t.beforeUpdateComponentCallback,d=void 0===l?Y:l;o(this,e),s(this,"registerListener",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y;if(n.rawData.boxes[e]){var o=n.rawData.resolved.boxes[e];setTimeout((function(){t(o)}),0)}n.listeners[e]={onChange:t,onProgress:r}})),this.appContext=r,this.rawData=new ge,this.listeners={},this.analytics=i,this.updateViewIdCallback=a,this.updateComponentCallback=u,this.beforeUpdateComponentCallback=d}return a(e,[{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,r=n.boxes,o=n.boxNameToIdMap,i=n.meta,a=i.defaultCustomParams,s=i.viewId;this.analytics&&this.analytics.updateCustomParams(a,s),this.updateViewIdCallback&&this.updateViewIdCallback(s),x(r).forEach((function(e){var n=v(e,2),r=n[0],o=n[1];T(o)||t.updateComponentCallback(r,o)})),C(o).forEach((function(e){var n=r[o[e]];if(!T(n)){var i=t.listeners[e];i&&M(i.onChange)&&setTimeout((function(){return i.onChange(n)}),0)}})),new ke({meta:i},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),C(this.listeners).forEach((function(t){var n=e.listeners[t];n&&M(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}(),Se=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,{exports:{}});Se.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}function t(n,r){var o=n,i=r;e(n)||(o={}),e(r)||(i={});var a=Object.keys(o),s=Object.keys(i),c={};return a.forEach((function(n){-1!==s.indexOf(n)?null===o[n]?c[n]=i[n]:e(o[n])&&e(i[n])?c[n]=t(o[n],i[n]):c[n]=i[n]:c[n]=o[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(c[e]=i[e])})),c}function n(n){var r=n;e(n)||(r={});for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return i.forEach((function(n){e(n)&&(r=t(r,n))})),r}return n}();var Ie=Se.exports,Ne=new WeakMap,Ae=new WeakMap,Oe=new WeakMap,Re="data-analytics-enabled",Te=function(e){return j(e,"[".concat(Re,"]"))},Me=function(e){var t=j(e,"[".concat("data-analytics-proxied","]")).reduce((function(e,t){var n,r=Te(t).filter((function(t){return!e.includes(t)}));return r.length?(n=r,e.concat(n)):e}),[]);return Te(e).filter((function(e){return!t.includes(e)}))},Ve=function(e){return Ae.has(e)},je=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&!Ve(e)){var r=parseInt(Oe.get(e),10)||0,o=r+t;o>=n&&(Ae.set(e,!0),X(e,"boxView",{bubbles:!0})),Oe.set(e,o)}},Le=function(e,t,n,r){var o={lowerValue:e,higherValue:t,viewportDimension:n,overrideLength:r};return Ne.has(o)||Ne.set(o,e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:e<=0&&t>=n?n:r),Ne.get(o)},Be="data-analytics-tags",We="data-item",Ue=function(e){return e.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()}))},He=function(e){for(var t=e.contextNode,n=e.stringParamCustomPrefix,r=e.jsonParamCustomPrefix,o=e.reportError,i=void 0===o?function(){}:o,a={},s=0;s<t.attributes.length;s+=1){var c=t.attributes[s];if(n&&c.name.startsWith(n)){var u=c.name.replace(n,"");a[Ue(u)]=c.value}if(r&&c.name.startsWith(r)){var l=c.name.replace(r,"");try{a[Ue(l)]=S(c.value)}catch(e){i(new Error('An error "'.concat(e.message,'" occurred while extracting custom parameters from attributes')))}}}return a},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return t?Ie(e,{_opbox:{viewId:t}}):e},_e=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,o=e.reportError,i=He({contextNode:t,stringParamCustomPrefix:"data-analytics-view-opbox-custom-"}),a=C(i).length?{_opbox:i}:{};return Ie(He({contextNode:t,stringParamCustomPrefix:"data-analytics-view-custom-",jsonParamCustomPrefix:"data-analytics-view-json-custom-",reportError:o}),a,r)},ze=function(e){var t=e.contextNode,n=e.coordinates,r=void 0===n?{}:n,o=e.destinationUrl,i=void 0===o?"":o,a=e.customParams,s=void 0===a?{}:a,c=e.isNewTab,u=c?{isNewTab:c}:{},l=Object.assign({},He({contextNode:t,stringParamCustomPrefix:"data-analytics-click-opbox-custom-"}),{destinationUrl:i},u,r);return Ie(He({contextNode:t,stringParamCustomPrefix:"data-analytics-click-custom-"}),{_opbox:l},s)},De=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,o=He({contextNode:t,stringParamCustomPrefix:"data-analytics-interaction-custom-"}),i=He({contextNode:t,stringParamCustomPrefix:"data-analytics-interaction-opbox-custom-"}),a=C(i).length?{_opbox:i}:{};return Ie(o,a,r)},qe=function(e){var t=e.closest("[".concat(Be,"]"));if(!t)return[];var n,r,o,i,a=!!t.closest("[".concat(We,"]"))?function(e){var t=e&&e.closest("[".concat("data-box-name","][").concat(Be,"]"));return t&&W(t,Be)||""}(t):"",s=W(t,Be)||"";return n=s,r=a.split(","),o=n.split(","),(i=r.concat(o)).filter((function(e,t){return e&&i.indexOf(e)===t}))},Ge=function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(W(t,"data-analytics-groups"));try{n=S(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]},Ye=function(e,t,n){return ne(e,t,n),function(){e.removeEventListener(t,n)}},Je=function(){function e(t){var n=this,r=t.targetWindow,i=t.config,a=t.cookieMonsterClient,c=t.boxViewsMarker,u=t.reportError;o(this,e),s(this,"sendPingEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,r=e.scrollBottom,o=e.pageHeight,i={category:"Engagement",label:"ping",customParams:{et:t,sb:r,ph:o}};n.cookieMonsterClient.send("event",i),n.callEventCallbacks(i)})),s(this,"detectAdblock",(function(){var e=n.document,t=z(e,"div",{innerHTML:"&nbsp;",className:"adsbox"});e.body.appendChild(t),n.targetWindow.setTimeout((function(){var r=0!==t.offsetHeight;n.cookieMonsterClient.send("event",{category:"clearPV",action:r,customParams:n.defaultCustomParams.ev}),e.body.removeChild(t)}),100)})),s(this,"handleClick",(function(e){n.handleBoxInteraction(e),n.handleLinkClick(e)})),s(this,"handleLinkClick",(function(e){if(M(e.target.closest))if(n.shouldHandleBoxInteraction(e))n.handleBoxInteraction(e);else{var t=e.target.closest("a");if(t&&B(t,"data-analytics-clickable")){var r=W(t,"data-analytics-click-label")||"",o=W(t,"data-analytics-click-value")||ae(t).trim(),i="_blank"===W(t,"target"),a=W(t,"href"),s=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&n.sendClickEvent({contextNode:t,label:r,value:o,customParams:ze({contextNode:t,coordinates:s,destinationUrl:a,isNewTab:!0})}):n.sendContextmenuEvent({contextNode:t,label:r,value:o,customParams:ze({contextNode:t,coordinates:s,destinationUrl:a})}):n.sendClickEvent({contextNode:t,label:r,value:o,customParams:ze({contextNode:t,coordinates:s,destinationUrl:a,isNewTab:i||e.metaKey||e.ctrlKey})})}}})),s(this,"handleChange",(function(e){var t=e.target;if("select-one"===t.type&&t&&B(t,"data-analytics-selectable")){var r=t.options[t.selectedIndex].value,o=He({contextNode:t,stringParamCustomPrefix:"data-analytics-select-custom-"});n.sendEvent({contextNode:t,action:"change",value:r,customParams:o})}})),s(this,"handleSubmit",(function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&B(t,"data-analytics-submittable")){var r=W(t,"action"),o=k(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),i=(o=o?"?".concat(o):"")?r+o:r;i=encodeURI(i),n.sendFormSubmitEvent({contextNode:t,value:i,label:"submitForm"})}})),s(this,"handleBoxView",(function(e){var t=e.target;if(t&&B(t,"data-analytics-enabled")&&!k(t.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))){var r=W(t,"data-analytics-view-value")||"",o=W(t,"data-analytics-view-label")||"",i=_e({contextNode:t,reportError:n.reportError});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(i=Object.assign({},i,He({contextNode:t.firstChild,stringParamCustomPrefix:"data-analytics-view-custom-"}))),B(t,We))return n.markParentBoxAsVisible(t),void n.sendItemViewEvent({contextNode:t,label:o,value:r,customParams:i});i=Object.assign({},i,function(e){if(!e)return{};var t=W(e,"data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=S(decodeURIComponent(t))}catch(e){console.log(e)}return n}(t)),n.sendBoxViewEvent({contextNode:t,value:r,customParams:i})}}));var l=i.cookieMonster,d=(l=void 0===l?{}:l).account,h=l.isEngagementMeasuringEnabled,f=l.defaultCustomParams,p=void 0===f?{}:f,v=i.viewId;this.targetWindow=r,this.document=r.document,this.account=d,this.isEngagementMeasuringEnabled=h,this.cookieMonsterClient=a,this.boxViewsMarker=c,this.reportError=u,this.defaultCustomParams=p,this.viewId=v,this.eventCallbacks=[];var m=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).navigator,t=(e=void 0===e?{}:e).userAgent;return void 0===t?"":t}(r);this.isMobile=function(e){return!!e.match(ee)}(m),this.isSafari=function(e){return!!e.match(Z)}(m),this.isFirefox=function(e){return e.toLowerCase().includes("firefox")}(m)}return a(e,[{key:"initialize",value:function(){var e=this;if(this.account){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&Promise.resolve().then((function(){return dn})).then((function(t){(0,t.attachEngagementObserver)({targetWindow:e.targetWindow,onCycleComplete:e.sendPingEvent})}));var t=this.document;this.eventHandlers=[Ye(t,"change",this.handleChange),Ye(t,"click",this.handleClick),Ye(t,"mousedown",this.handleLinkClick),Ye(t,"submit",this.handleSubmit),Ye(t,"contextmenu",this.handleClick),Ye(t,"boxView",this.handleBoxView),Ye(this.targetWindow,"DOMContentLoaded",this.detectAdblock)]}}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e()}))}},{key:"callEventCallbacks",value:function(e){this.eventCallbacks.length&&this.eventCallbacks.forEach((function(t){return t(e)}))}},{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextNode,n=e.action,r=e.label,o=void 0===r?"":r,i=e.value,a=e.customParams,s=void 0===a?{}:a;if(!t||!n)return{};var c=t.closest("[data-analytics-category]").getAttribute("data-analytics-category"),u=F(t.closest("[data-box-name]")),l=t.closest("[data-box-id]"),d=l&&H(l),h=qe(t),f=Ge(t),p=h.length?{analyticsTags:h}:{},v=f.length?{groups:f}:{},m=d?{boxName:u,boxId:d}:{boxName:u},g=Object.assign({},p,v,m),y=Ie(Object.assign({},s),{_opbox:g},this.defaultCustomParams.ev),b={category:c,action:n,label:o,value:i,customParams:y};return this.cookieMonsterClient.send("event",b),this.callEventCallbacks(b),b}},{key:"sendClickEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}},{key:"handleBoxInteraction",value:function(e){if(M(e.target.closest)){var t=e.target.closest("[data-analytics-interaction]");if(t){var n=De({contextNode:t}),r=W(t,"data-analytics-interaction-label")||"",o=W(t,"data-analytics-interaction-value")||ae(t).trim();this.sendBoxInteractionEvent({contextNode:t,label:r,value:o,customParams:n})}}}},{key:"shouldHandleBoxInteraction",value:function(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!Ve(t)&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"sendPageViewProxy",value:function(){this.account&&(this.cookieMonsterClient.sendPageView(Fe(this.defaultCustomParams.pv,this.viewId)),this.cookieMonsterClient.updateReferrer())}},{key:"sendEventProxy",value:function(e,t,n,r,o){return this.account?e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:n,label:o,action:t,contextNode:e,customParams:r}):this.sendEvent(e):null}},{key:"sendItemViewEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams;this.account&&this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:_e({contextNode:t,customParams:o,reportError:this.reportError})})}},{key:"sendClickEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams,i=e.destinationUrl,a=e.isNewTab;if(this.account){if(a&&"boolean"!==A(a))throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:t,label:n,value:r,customParams:ze({contextNode:t,destinationUrl:i,customParams:o,isNewTab:a})})}}},{key:"sendContextmenuEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams,i=e.destinationUrl;this.account&&this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:ze({contextNode:t,destinationUrl:i,customParams:o})})}},{key:"sendBoxInteractionEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams;this.account&&this.sendBoxInteractionEvent({contextNode:t,label:n,value:r,customParams:De({contextNode:t,customParams:o})})}},{key:"updateCustomParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pv,n=void 0===t?{}:t,r=e.ev,o=void 0===r?{}:r,i=arguments.length>1?arguments[1]:void 0;this.viewId=i,O(n)&&O(o)?this.defaultCustomParams={pv:n,ev:o}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){this.account&&e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}]),e}();function Xe(e){return O(e)&&!("clientImplementationVersion"in e)?w(e,{clientImplementationVersion:""}):e}function Ke(e){var t=e.instance,n=e.method,r=e.reportError,o=e.data,i=void 0===o?null:o,a=e.onSuccess,s=void 0===a?function(){}:a;if(t&&M(t[n]))try{t[n](i),s()}catch(e){r(new Error('There was some problem executing "'.concat(n,'" method on box instance: ').concat(e.message)))}}function Qe(e){return N(e)?e.map(Xe):Xe(e)}function $e(e,t){return""===t?e:"".concat(e,"@").concat(t)}var Ze=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.targetWindow,i=n.services,a=n.reportError,c=n.unmountNodeCallback,u=n.mountNodeCallback,l=n.componentNodesFinder,d=n.serializedPropsFinder,h=n.registerPrototypeCallback;o(this,e),s(this,"unmountNode",(function(e){t.unmountNodeCallback(e),j(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=H(e)||F(e);Ke({instance:t.instances.get(n),method:"onUnmount",reportError:t.reportError}),t.instances.set(n,null)}))})),s(this,"mountNode",(function(e){j(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=U(e),r=_(e)||"";t.registerInstancesForPrototype(n,r,[e])})),t.mountNodeCallback(e)})),s(this,"updateComponentCallback",(function(e,n){var r=t.instances.get(e);r?Ke({instance:r,method:"onUpdate",reportError:t.reportError,data:n}):t.boxDataCache.set(e,n)})),s(this,"beforeUpdateComponentCallback",(function(){t.instances.forEach((function(e){return Ke({instance:e,method:"beforeOnUpdate",reportError:t.reportError})}))})),s(this,"register",(function(e,n){var r=Qe(e);t.isPrototypeValid(r)&&t.isImplementationValid(n)&&(N(r)?r.forEach((function(e){t.registerImplementationAndInstances(e,n)})):t.registerImplementationAndInstances(r,n))})),this.targetWindow=r,this.services=i,this.implementations=new Map,this.instances=new Map,this.boxDataCache=new Map,this.reportError=a,this.unmountNodeCallback=c,this.mountNodeCallback=u,this.registerPrototypeCallback=h,this.serializedPropsFinder=d,this.componentNodesFinder=l}return a(e,[{key:"isPrototypeObjectValid",value:function(e){var t=e.prototypeName,n=e.clientImplementationVersion;return"prototypeName"in e?""===t?(this.reportError(new Error('Property "prototypeName" cannot be empty string')),!1):R(t)?!!R(n)||(this.reportError(new Error('Property "clientImplementationVersion" must be string but got '.concat(A(n)))),!1):(this.reportError(new Error('Property "prototypeName" must be string but got '.concat(A(t)))),!1):(this.reportError(new Error('Property "handledPrototype" must have "prototypeName" field')),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError(new Error("Empty handledPrototypes list")),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return N(e)?this.containsValidPrototypes(e):O(e)?this.isPrototypeObjectValid(e):(this.reportError(new Error('"handledPrototype" argument must be an object or an array')),!1)}},{key:"isImplementationValid",value:function(e){return M(e)?e.prototype.onUpdate&&!M(e.prototype.onUpdate)?(this.reportError(new Error('"onUpdate" property must be a function or undefined but got '.concat(A(e.prototype.onUpdate)))),!1):!!M(e.prototype.onMount)||(this.reportError(new Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(new Error('"implementation" must be a class')),!1)}},{key:"registerInstancesForPrototype",value:function(e,t,n){var r=this.implementations.get($e(e,t));r&&(this.registerInstances(n,this.services.getServicesForComponent(e),r),this.registerPrototypeCallback(e,t))}},{key:"registerImplementationAndInstances",value:function(e,t){var n=e.prototypeName,r=e.clientImplementationVersion,o=$e(n,r),i=""===r;this.implementations.has(o)?this.reportError(new Error("".concat(n," ").concat(i?"":"with ".concat(r," client implementation version "),"already registered!"))):(this.implementations.set(o,t),this.registerInstancesForPrototype(n,r,this.componentNodesFinder.find(n,r)))}},{key:"registerInstances",value:function(e,t,n){var r=this;e.forEach((function(e){if(!W(e,"data-pathname")){var o=F(e),i=H(e),a=r.serializedPropsFinder.getPropsForBox(i,o),s=new n({baseNode:e,props:a,services:t}),c=i||o;r.instances.get(c)||(Ke({instance:s,method:"onMount",reportError:r.reportError,onSuccess:function(){r.instances.set(c,s)}}),r.boxDataCache.has(c)&&(Ke({instance:s,method:"beforeOnUpdate",reportError:r.reportError}),r.updateComponentCallback(c,r.boxDataCache.get(c)),r.boxDataCache.delete(c)))}}))}},{key:"createPublicAPI",value:function(){return{register:this.register}}},{key:"createPrivateAPI",value:function(){var e=this;return{updateComponentCallback:this.updateComponentCallback,beforeUpdateComponentCallback:this.beforeUpdateComponentCallback,unmountNode:this.unmountNode,mountNode:this.mountNode,updateSerializedPropsCollection:function(){e.serializedPropsFinder.updateNodesCollection()},updateComponentNodesCollection:function(){e.componentNodesFinder.updateNodesCollection()}}}}]),e}(),et="data-serialize-box-id",tt="data-serialize-box-name",nt="script[".concat(et,"], script[").concat(tt,"]"),rt=function(){function e(t,n){o(this,e),this.targetWindow=t,this.reportError=n,this.collection=[],this.updateNodesCollection()}return a(e,[{key:"updateNodesCollection",value:function(){this.collection=j(this.targetWindow.document,nt)}},{key:"getNodeByBoxId",value:function(e){return this.collection.find((function(t){return W(t,et)===e}))}},{key:"getNodeByBoxName",value:function(e){return this.collection.find((function(t){return W(t,tt)===e}))}},{key:"getPropsFromNode",value:function(e){if(!e)return{};try{return S(ae(e))}catch(e){return this.reportError(e),{}}}},{key:"getPropsForBox",value:function(e,t){var n=this.getNodeByBoxId(e)||this.getNodeByBoxName(t);return n?this.getPropsFromNode(n):{}}}]),e}(),ot=function(e,t){return function(e,n){var r=e.prototypeName;r&&n({domNodes:t.find(r)})}},it=["Content-Type"],at=function(){return Promise.reject(new Error("missing edge host"))},st="application/vnd.allegro.public.v1+json",ct=function(){function e(t){var n=this,r=t.httpClient,i=t.edgeHost,a=t.language;o(this,e),s(this,"get",(function(e,t){return n.httpClient.get(n.prepareRequestUrl(e),n.prepareRequestSettings(t,!0))})),s(this,"put",(function(e,t,r){return n.httpClient.put(n.prepareRequestUrl(e),t,n.prepareRequestSettings(r))})),s(this,"post",(function(e,t,r){return n.httpClient.post(n.prepareRequestUrl(e),t,n.prepareRequestSettings(r))})),s(this,"patch",(function(e,t,r){return n.httpClient.patch(n.prepareRequestUrl(e),t,n.prepareRequestSettings(r))})),s(this,"delete",(function(e,t){return n.httpClient.delete(n.prepareRequestUrl(e),n.prepareRequestSettings(t,!0))})),this.edgeHost=i,this.httpClient=r,this.defaultHeaders={"Content-Type":st,Accept:st,"Accept-Language":a}}return a(e,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.disableDefaultHeaders)return e;var n=this.normalizeSettings(e),r=this.defaultHeaders;r["Content-Type"];var o=f(r,it);return Ie({},t?{headers:o}:{headers:this.defaultHeaders},n)}},{key:"normalizeSettings",value:function(e){if(!e||!e.headers)return e;var t=Q(e.headers,C(this.defaultHeaders));return w(e,{headers:t})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"createAPI",value:function(){return this.edgeHost?{get:this.get,put:this.put,post:this.post,patch:this.patch,delete:this.delete}:{get:at,put:at,post:at,patch:at,delete:at}}}]),e}();function ut(e){var t=this,n=e.targetWindow,r=e.alias,o=void 0===r?"cm":r,i=e.config,a=void 0===i?{}:i,s=a.cookieMonster,c=s.host,u=s.account,l=s.defaultCustomParams,d=void 0===l?{}:l,h=a.viewId,f=n.document,p=function(){return M(n[o])},v=function(){if(!p()){n["cm.analytics.object"]=o,n[o]=n[o]||function(){(n[o].q=n[o].q||[]).push(P(arguments))};var e=f.createElement("script");e.src=c,f.head.appendChild(e)}};function m(){p()&&n[o].apply(null,P(arguments))}function g(){var e="send@".concat(u);m.apply(null,[e].concat(P(arguments)))}var y=a.cookieMonster.referrer||f.referrer,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe(d.pv,h);g("pageview",{customParams:e,referrer:y})},w=function(){y=window.location.href},E={initialize:function(){c&&u&&!p()?(v(),m("create",u),b(),w()):w()},updateReferrer:w,send:g,sendPageView:b};C(E).forEach((function(e){t[e]=E[e]}))}var lt=function(){function e(t){var n,r,i,a,c=this,u=t.targetWindow,l=t.boxes,d=void 0===l?[]:l,h=t.significantElementSizePercentage,f=void 0===h?.75:h,p=t.significantElementSizeForBiggerThanViewportPercentage,v=void 0===p?.5:p,m=t.timeoutValue,g=void 0===m?500:m,y=t.debounceTimeoutValue,b=void 0===y?20:y;o(this,e),s(this,"markCurrentlyVisibleElementsAsSeen",(function(){var e=c.config.timeoutValue;c.visibleElements.forEach((function(t){je(t,e,e)}))})),s(this,"markPreviouslyVisibleElementAsHidden",(function(e){c.visibleElementsByIntersectionObserver.has(e)&&(c.visibleElementsByIntersectionObserver.delete(e),X(e,"outOfViewport"))})),s(this,"intersectionHandler",(function(e){e.forEach((function(e){var t=e.target,n=e.boundingClientRect,r=e.rootBounds;r&&function(e,t,n,r){var o=e.right-e.left,i=e.bottom-e.top,a=t.height,s=t.width,c=function(e,t){return(e.top>=t.top&&e.top<=t.bottom||e.bottom<=t.bottom&&e.bottom>=t.top||e.top<t.top&&e.bottom>t.bottom)&&(e.left>=t.left&&e.left<=t.right||e.right<=t.right&&e.right>=t.left||e.left<t.left&&e.right>t.right)}(e,t),u=c?Le(e.left,e.right,t.width,o):0,l=c?Le(e.top,e.bottom,t.height,i):0;return i>a&&l>a*r||o>s&&u>s*r||l*u/(o*i)>n}(n,r,c.config.significantElementSizePercentage,c.config.significantElementSizeForBiggerThanViewportPercentage)?c.visibleElementsByIntersectionObserver.has(t)||(c.visibleElementsByIntersectionObserver.add(t),c.notVisibleElements.delete(t),X(t,"inViewport")):(c.markPreviouslyVisibleElementAsHidden(t),c.notVisibleElements.add(t))})),c.resetCurrentlyVisibleElementsOnTimeout()})),s(this,"scrollHandler",(function(){c.state.isScrolling||(c.state.scrollStartTime=(new Date).getTime(),c.state.isScrolling=!0),clearTimeout(c.markCurrentlyVisibleElementsAsSeenOnTimeout()),c.scrollEndHandler()})),s(this,"addBox",(function(e){null!==e&&-1===c.boxes.indexOf(e)&&(c.boxes.push(e),c.observer.observe(e))})),s(this,"isBoxInViewport",(function(e){return c.visibleElementsByIntersectionObserver.has(e)})),s(this,"markBoxAsRendered",(function(e){return B(e,Re)&&c.addBox(e),Me(e).forEach(c.addBox),Promise.resolve()})),s(this,"markBoxAsVisible",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.addBox(e),t){var n=c.config.timeoutValue;je(e,n,n)}})),s(this,"recursivelyMarkBoxAsVisible",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.markBoxAsVisible(e,t),Me(e).forEach((function(e){return c.markBoxAsVisible(e,t)}))})),s(this,"removeBox",(function(e,t){null!==e&&(c.markPreviouslyVisibleElementAsHidden(e),function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&Ae.delete(e),Oe.delete(e)}(e,t),c.boxes=c.boxes.filter((function(t){return t!==e})),c.visibleElements=c.visibleElements.filter((function(t){return t!==e})),c.observer.unobserve(e))})),s(this,"markBoxAsHidden",(function(e){c.removeBox(e,!1),c.resetCurrentlyVisibleElementsOnTimeout()})),s(this,"unmountNode",(function(e){Te(e).forEach(c.removeBox)})),s(this,"recursivelyMarkBoxAsHidden",(function(e){c.markBoxAsHidden(e),Me(e).forEach(c.markBoxAsHidden)})),s(this,"trackBoxScroll",(function(e){ne(e,"scroll",c.scrollHandler)})),this.targetWindow=u,this.document=u.document,this.config={timeoutValue:g,debounceTimeoutValue:b,significantElementSizePercentage:f,significantElementSizeForBiggerThanViewportPercentage:v},this.resetState(),this.boxes=d.length?d:Me(u.document),this.visibleElements=[],this.visibleElementsByIntersectionObserver=new Set,this.notVisibleElements=new Set,this.observer=new u.IntersectionObserver(this.intersectionHandler,{threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),this.scrollEndHandler=J(this.resetCurrentlyVisibleElementsAfterScroll,b),this.resetCurrentlyVisibleElementsOnTimeout=(n=this.resetCurrentlyVisibleElements.bind(this),r=b,function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];var s=this;return new Promise((function(e){var o=i&&!a;clearTimeout(a),a=setTimeout((function(){a=null,i||e(n.apply(s,t))}),r),o&&e(n.apply(s,t))}))}),this.markCurrentlyVisibleElementsAsSeenOnTimeout=J(this.markCurrentlyVisibleElementsAsSeen,g)}return a(e,[{key:"resetState",value:function(){var e=re();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=re();this.visibleElements.forEach((function(n){je(n,t-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){je(t,e.state.scrollStartTime-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"resetCurrentlyVisibleElements",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeen(),this.visibleElements=[],this.visibleElementsByIntersectionObserver.forEach((function(t){return e.visibleElements.push(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.notVisibleElements.forEach((function(t){e.observer.unobserve(t),e.observer.observe(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"initialize",value:function(){var e=this;ne(this.targetWindow,"scroll",this.scrollHandler),this.boxes.forEach((function(t){return e.observer.observe(t)}))}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered,markBoxAsVisible:this.markBoxAsVisible,recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible,markBoxAsHidden:this.markBoxAsHidden,recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden,trackBoxScroll:this.trackBoxScroll,isBoxInViewport:this.isBoxInViewport}}}]),e}(),dt=/([^&=]+)=?([^&]*)/g;function ht(e){for(var t,n,r,o,i={},a=e.substring(e.indexOf("?")+1,e.length);t=dt.exec(a);)n=i,r=decodeURIComponent(t[1]),o=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[r]?n[r]=[o]:n[r].push(o);return i}function ft(e){var t,n="";return new URLSearchParams((t=e,C(t).flatMap((function(e){return t[e].map((function(t){return[e,t]}))})))).forEach((function(e,t){if("null"!==e&&"undefined"!==e&&!T(e)){var r=n?"&":"?",o=encodeURIComponent(t),i=encodeURIComponent(e);n="".concat(n).concat(r).concat(o,"=").concat(i)}})),n}var pt=function(e,t){var n,r=ht(e),o=r.route;function i(e){t.forEach((function(t){return n=e,r=t.name,o=t.value,void(n[r]=N(o)?o:[o]);var n,r,o}))}if(o&&o.startsWith("http")){var a=v(o.split("?"),2),s=a[0],c=a[1];i(n=c?ht(c):[]),o=s+ft(n)}else i(r);return ft(r)},vt=function(){function e(t){var n=this,r=t.targetWindow,i=t.opboxWebClient,a=t.rawDataListenersRegistry,c=t.reportError;o(this,e),s(this,"navigateRelative",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.persistHash,o=void 0!==r&&r,i=t.shouldReplaceState,a=void 0!==i&&i,s=n.location,c=s.pathname,u=s.search,l=s.hash,d=o?l:"",h=c+u+d,f=e.filter((function(e){return!e.fetchUrlOnly})),p=pt(u,f),v=pt(u,e),m=c+p+d,g=c+v+d;return g!==n.lastFetchPath&&n.fetch(g),m!==h&&(n.changeUrl(m,a),a||n.history.push(c),n.changeCallbacks.forEach((function(e){return e()})),n.targetWindow.performance.mark("clientSideNavigationStart")),m})),s(this,"refreshPage",(function(){var e=n.location,t=e.pathname+e.search;n.fetch(t)})),s(this,"changeState",(function(e){var t=e.queryParameters,r=e.hash,o=e.shouldChangeHistory;if(!t&&!R(r))return n.reportError(new Error("New parameters (array) or hash (string) required")),null;var i,a=n.location,s=a.pathname,c=a.search,u=a.hash,l=s+c+u,d=R(r)?""===(i=r)||"#"===i[0]?i:"#".concat(i):u,h=s+pt(c,t||[])+d;if(h!==l){var f=o?"pushState":"replaceState";n.targetWindow.history[f]("","",h),n.changeStateCallbacks.forEach((function(e){return e()}))}return h})),s(this,"registerChangeCallback",(function(e){n.registerCallback(e,n.changeCallbacks)})),s(this,"registerChangeStateCallback",(function(e){n.registerCallback(e,n.changeStateCallbacks)}));var u=r.location,l=u.pathname,d=u.search;this.targetWindow=r,this.location=r.location,this.opboxWebClient=i,this.rawDataListenersRegistry=a,this.reportError=c,this.history=[l],this.lastFetchPath=l+d,this.changeCallbacks=[],this.changeStateCallbacks=[]}return a(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"changeUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this.targetWindow.history.replaceState("","",e):this.targetWindow.history.pushState("","",e)}},{key:"handlePopState",value:function(e){var t=e.target.location,n=t.pathname,r=n+t.search;this.isInternalNavigation(n)&&this.lastFetchPath!==r&&this.refreshPage()}},{key:"fetch",value:function(e){var t=this;this.lastFetchPath=e,this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then((function(e){return t.rawDataListenersRegistry.triggerChangeListener(e)})).catch((function(n){t.reportError(new Error("Error while fetching page data for path ".concat(e,": ").concat(n.message)))}))}},{key:"registerCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];M(e)?t.push(e):this.reportError(new Error('First argument must be a function but got "'.concat(A(e),'"')))}},{key:"createAPI",value:function(){return{registerChangeCallback:this.registerChangeCallback,registerChangeStateCallback:this.registerChangeStateCallback,changeState:this.changeState}}}]),e}(),mt=500,gt="opboxAnimationTimerInterval",yt=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},bt=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function wt(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=o.duration,a=void 0===i?mt:i,s=o.onFinish;if(!M(r))return null;var c=bt(e),u=re(),l=n-t,d=!1,h=function(){d=!0},f=function e(){var n=re()-u;if(d||n>=a)M(s)&&s(),d=!1;else{var o=Math.min(n/a,1),i=yt(o)*l+t;r(i),c(e)}};return f(),{stop:h}}function Et(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,o=void 0===r?mt:r,i=e.pageYOffset,a=Math.max(0,t),s=e.document.body.scrollHeight;function c(t){var n=t===a||t===a,r=e.innerHeight+t>=s;return n||r}function u(){e[gt]&&M(e[gt].stop)&&(e[gt].stop(),e[gt]=null)}var l=function(t){e.scrollTo(0,Math.round(t)),c(t)&&u()};u(),e[gt]=wt(e,i,t,l,{duration:o})}var Ct=function(){function e(){var t=this;o(this,e),this.status=1,this.promise=new Promise((function(e){t.resolve=e}))}return a(e,[{key:"registerImplementation",value:function(e){this.status=2,this.resolve(e)}}]),e}(),xt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.reportError,i=n.allowedPlugins,a=void 0===i?[]:i;o(this,e),s(this,"addPluginToRegistry",(function(e){var n=e.name;t.isPluginAvailable(n)||t.pluginsRegistry.set(n,new Ct)})),s(this,"register",(function(e,n){if(e){var r=e.name;if(R(r))if(r)if(n)if(t.isPluginAvailable(r)){var o=t.pluginsRegistry.get(r);2!==o.status?o.registerImplementation(n):t.reportRegistrationError('Plugin "'.concat(r,'" is already registered on page'),!0)}else t.reportRegistrationError('Plugin "'.concat(r,'" is not allowed to register on this page'));else t.reportRegistrationError('Second argument "implementation" is required');else t.reportRegistrationError('Property "name" should be a non-empty string');else t.reportRegistrationError('Property "name" should be a string')}else t.reportRegistrationError('First argument "config" should be defined')})),s(this,"getPlugin",(function(e){return t.isPluginAvailable(e)?t.pluginsRegistry.get(e).promise:Promise.reject(new Error('Plugin "'.concat(e,'" is unavailable')))})),s(this,"updateRegistry",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach(t.addPluginToRegistry)})),this.reportError=r,this.pluginsRegistry=new Map,this.boundUpdateRegistry=this.updateRegistry,this.updateRegistry(a)}return a(e,[{key:"isPluginAvailable",value:function(e){return this.pluginsRegistry.has(e)}},{key:"reportRegistrationError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Error("Plugin registration error. ".concat(e));t?console.error(n):this.reportError(n)}},{key:"createAPI",value:function(){return{register:this.register,get:this.getPlugin}}}]),e}();function kt(e,t){return function(n){if(!e.has(n))return Promise.reject(new Error("Service ".concat(n," is not registered")));var r=e.get(n);return r.fetchIfNotFetched(t),r.promise}}var Pt=a((function e(t){var n=this,r=t.prototypeName,i=t.servicesRegistry,a=t.targetWindow;o(this,e),this.services=new Map,i.forEach((function(e,t){e.components.some((function(e){return e===r}))&&n.services.set(t,e)})),this.get=kt(this.services,a)})),St=function(e,t){var n,r,o,i,a=e.document.documentElement,s=a.clientWidth,c=a.clientHeight,u=e.navigator.userAgent,l=(n=e.navigator,r=n.connection,o=n.mozConnection,i=n.webkitConnection,r||o||i||{}).downlink,d="".concat(s,"x").concat(c),h=!V(t);return Object.assign({device:{viewport:d,ua:u}},h&&{other:t},l&&{connection:{speed:l}})},It=function(e){return function(t,n){0!==t.status&&(console.error("Error: ".concat(t.message)),e.opbox.plugin.get("sentry").then((function(r){return r.captureException(t,{contexts:St(e,n)})})).catch(Y))}};function Nt(e,t){return t.filter((function(t){return!e.find((n=t,function(e){if(n.url)return[e.url,e.href,e.src].includes(n.url);if(n.code){var t=n.attributes,r=void 0===t?{}:t,o=!C(r).some((function(t){return r[t]!==W(e.node,t)}));return n.code===e.code&&o}return!1}));var n}))}function At(e,n,o){if(!n.length)return Promise.resolve();var i=function(e){return k(e.document.getElementsByTagName("script"),(function(e){return{src:e.src,code:e.innerHTML,nonce:e.nonce,node:e}}))}(e),a=function(e){return(e.find((function(e){return!!e.nonce}))||{}).nonce}(i),s=v(Nt(i,n).reduce((function(e,t){return e[t.async?0:1].push(t),e}),[[],[]]),2),c=s[0],u=s[1],l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y,r=e.document,o=It(e),i=oe(e);return function(e){var a=e.url,s=e.code,c=e.attributes,u=e.type;return a||s?new Promise((function(e){var l,d=!a&&!!s,h="module"===u,f=z(r,"script"),p=!1,m=function t(n){e(),n.message||(n.message="Error while loading script: ".concat(a)),o(n),f.removeEventListener("error",t)};if(!h||i){if(c){if(c.nomodule&&i)return void e();x(c).forEach((function(e){var t=v(e,2),n=t[0],o=t[1];"data-serialize-box-id"!==n&&"data-serialize-box-name"!==n||(p=!0,l=L(r,"[".concat(n,'="').concat(o,'"]'))),f.setAttribute(n,o)}))}t&&f.setAttribute("nonce",t),u&&(f.type=u),d?(f.innerHTML=s,e()):(f.src=a,ne(f,"load",(function t(){e(),f.removeEventListener("error",m),f.removeEventListener("load",t)})),ne(f,"error",m)),l?l.parentNode.replaceChild(f,l):r.body.appendChild(f),p&&n()}else e()})):Promise.resolve()}}(e,a,o),d=function(){var e,n=(e=t().mark((function e(){var n,r,o=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=o.length>0&&void 0!==o[0]?o[0]:[]).length){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return r=n.shift(),e.next=6,l(r);case 6:return e.abrupt("return",d(n));case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)}))});return function(){return n.apply(this,arguments)}}();return d(u).then((function(){return Promise.all(c.map(l))}))}var Ot=function(){function e(t){var n=this,r=t.assetUrls,i=t.components,a=t.reportError;o(this,e),this.assetUrls=r,this.components=i,this.reportError=a,this.implementation=null,this.status=0,this.promise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return a(e,[{key:"update",value:function(e){this.components=function(e,t){return t.reduce((function(e,t){return e.find((function(e){return e===t}))?e:e.concat([t])}),e)}(this.components,e)}},{key:"registerImplementation",value:function(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(e){this.handleError(new Error("Error while trying to register service implementation: ".concat(e.message)))}}},{key:"fetchIfNotFetched",value:function(e){var t=this;if(0===this.status){this.status=1;var n=this.assetUrls,r=n.module,o=n.nomodule;At(e,[oe(e)?{url:r,type:"module"}:{url:o}]).catch((function(e){t.handleError(new Error("Error while trying to inject service scripts: ".concat(e?e.message:"")))}))}}},{key:"handleError",value:function(e){this.reportError(e),this.status=2,this.reject()}}]),e}(),Rt=function(){function e(t){var n=this,r=t.targetWindow,i=t.reportError;o(this,e),s(this,"update",(function(e){e.forEach((function(e){var t=v(e,2),r=t[0],o=t[1],i=o.nomodule,a=o.module,s=o.components;n.servicesRegistry.has(r)?n.servicesRegistry.get(r).update(s):n.setServiceToRegistry(r,{nomodule:i,module:a},s)}))})),s(this,"register",(function(e,t){var r=e.serviceName;n.servicesRegistry.get(r).registerImplementation(t)})),this.targetWindow=r,this.reportError=i,this.servicesRegistry=new Map;var a=L(r.document,'script[data-config="services"]');if(a)try{S(ae(a)).forEach((function(e){var t=v(e,2),r=t[0],o=t[1],i=o.nomodule,a=o.module,s=o.components;n.setServiceToRegistry(r,{nomodule:i,module:a},s)}))}catch(e){i(e)}this.dangerouslyGet=kt(this.servicesRegistry,r)}return a(e,[{key:"getServicesForComponent",value:function(e){return new Pt({prototypeName:e,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}},{key:"setServiceToRegistry",value:function(e,t,n){this.servicesRegistry.set(e,new Ot({assetUrls:t,components:n,reportError:this.reportError}))}},{key:"createAPI",value:function(){return{register:this.register,__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}]),e}();function Tt(e,t){e.forEach((function(e){var n=e.args,r=e.reject,o=e.resolve,i=function(e,t){try{return e.apply(void 0,m(t))}catch(e){return void console.error(e)}}(t,n);i&&M(i.then)&&M(o)&&M(r)&&i.then(o,r)}))}function Mt(e,t,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];if(M(e)&&M(t)){if(!e.__queue__)return;Tt(e.__queue__,t),n.apply(void 0,[t].concat(o))}else O(e)&&O(t)&&C(e).forEach((function(r){Mt.apply(void 0,[e[r],t[r],n].concat(m(o.concat(r))))}))}var Vt=function(){return Date.now()};var jt=a((function e(t){var n=this,r=t.localStorage,i=t.reportError,a=t.ttlMs,c=void 0===a?2592e6:a,u=t.key,l=void 0===u?"opbox.preferences":u,d=t.timeProvider,h=void 0===d?Vt:d;o(this,e),s(this,"savePreferences",(function(e){var t=n.loadPreferences(),r=n.timeProvider(),o=e.reduce(te((function(e){return s({},e.name,{value:e.value,timestamp:r})})),t);n.writeToStorage(o)})),s(this,"writeToStorage",(function(e){try{n.storage.setItem(n.key,I(e))}catch(e){n.reportError(new Error("Error while writing data to storage. Error message: ".concat(e.message)))}})),s(this,"loadPreferences",(function(){try{return S(n.storage.getItem(n.key))||{}}catch(e){return n.reportError(new Error("Error while loading data from storage. Error message: ".concat(e.message))),{}}})),s(this,"cleanupPreferences",(function(){var e=n.loadPreferences(),t=n.timeProvider(),r=x(e).reduce(te((function(e){var r=v(e,2),o=r[0],i=r[1];return i.timestamp+n.ttlMs>t?s({},o,i):{}})),{});n.writeToStorage(r)})),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(r)?r:{setItem:function(){},getItem:function(){return{}}},this.ttlMs=c,this.key=l,this.timeProvider=h,this.reportError=i})),Lt=["Content-Type"],Bt="/preferences",Wt="illegal argument type provided as preferences",Ut={withCredentials:!0,headers:{"Content-Type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},Ht=function(){function e(t){var n=this,r=t.edgeClient,i=t.localStorage,a=t.ttlMs,c=t.reportError;o(this,e),s(this,"setPreference",(function(e,t){var r={name:e,value:t};return n.storage.savePreferences([r]),n.edgeClient.post(Bt,r,Ut)})),s(this,"getPreference",(function(e,t){return R(e)||e instanceof String?n.getPreferences(s({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))})),s(this,"setPreferences",(function(e){if(!O(e))return Promise.reject(Error(Wt));var t=x(e).map((function(e){var t=v(e,2);return{name:t[0],value:t[1]}}));return n.storage.savePreferences(t),n.edgeClient.post("/preferences/multi",I(t),Ut)})),s(this,"getPreferences",(function(e){if(!O(e))return Promise.reject(Error(Wt));var t=C(e).join(","),r="".concat(Bt,"?name=").concat(t),o=Ut.withCredentials,i=Ut.headers;i["Content-Type"];var a=f(i,Lt);return n.edgeClient.get(r,{withCredentials:o,headers:a}).then((function(e){var t=e.data.preferences;return n.storage.savePreferences(t),t.reduce(te((function(e){return s({},e.name,e.value)})),{})})).catch((function(){return n.getPreferencesFromLocalStorageOrDefaults(e)}))})),s(this,"getPreferencesFromLocalStorageOrDefaults",(function(e){n.storage.cleanupPreferences();var t=n.storage.loadPreferences();return x(e).reduce(te((function(e){var n=v(e,2),r=n[0],o=n[1];return s({},r,r in t?t[r].value:o)})),{})})),this.edgeClient=r,this.storage=new jt({localStorage:i,ttlMs:a,reportError:c})}return a(e,[{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,setMany:this.setPreferences,getMany:this.getPreferences}}}]),e}(),Ft=["crossOrigin"];function _t(e,t){var n=e.document,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.inHead,i=void 0!==o&&o,a=r.referenceNode,s=void 0===a?null:a;return function(e){if(V(e))return null;$(e,(function(e,t){return!(t||Ft.includes(e))}));var r=z(n,"link",e,{rel:t});s?D(s,r):n[i?"head":"body"].appendChild(r);return r}}var zt=["spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","tabs","typography","color","grid","calendar","attachment","article","navigation-tiles","pin","player-video","align","border","box-sizing","display","flex","height","margin","padding","position","transition","utils","visibility","white-space","width","zindex","core"];var Dt,qt=function(e){return function(t){return t.href.includes("".concat(e,"/"))}};function Gt(e,t){return e.findIndex((function(e){return e.selectorText===t}))}function Yt(e,t,n){var r=t.cssBundle,o=r.isEnabled,i=r.emptyRule,a=o?function(e){return k(e.document.styleSheets).find((function(e){var t=e.ownerNode;return t&&B(t,"data-metrum-bundle")}))}(e):null,s=[],c=function(e){return i.pattern.replace(i.replacementPart,e)};return{isEnabled:o,inject:function(t){if(!o)return Promise.resolve();var r,i,u,l,d,h,f=function(e,t){return t.reduce((function(t,n){var r=v(t,2),o=r[0],i=r[1];return e.includes(n)||i.push(n),o.push(n),[o,i]}),[[],[]])}(s,t),p=v(f,2),m=p[0],g=p[1];return s=m,g.length?(r=e.document,i=g,u=r.createDocumentFragment(),l=z(r,"div"),d=function(){r.body.removeChild(l)},h=i.map((function(e){return new Promise((function(t,n){var o=z(r,"link",{type:"text/css",rel:"stylesheet",crossOrigin:"",href:e,media:"not all"});ne(o,"load",(function(){t(o.sheet)})),ne(o,"error",n),l.appendChild(o)}))})),u.appendChild(l),r.body.appendChild(u),Promise.all(h).then((function(e){return[e,d]}))).then((function(e){var t=v(e,2),r=t[0],o=t[1];r.forEach((function(e){var t=k(a.cssRules),r=t.length;if(!function(e,t){return t.cssRules.length>0&&e.findIndex((function(e){return e.cssText===t.cssRules[0].cssText}))>-1}(t,e)){for(var o=G(e.href),i=n.indexOf(o),s=-1!==i?n.slice(i):[],u=r,l=0;l<s.length;l+=1){var d=Gt(t,c(s[l]));if(d>0){u=d;break}}var h=k(e.cssRules);h.unshift({cssText:"".concat(c(o),"{}")});for(var f=0;f<h.length;f+=1)a.insertRule(h[f].cssText,u+f)}})),o()})):Promise.resolve()}}}function Jt(e,t,n,r){var o=n.href,i=n.media,a=G(o);return r.includes(a)?function(e,t,n){var r=t.href,o=t.media,i=t.crossOrigin,a=_t(e,"stylesheet",{inHead:!0,referenceNode:n})(Object.assign({type:"text/css",href:r,media:o},!T(i)&&{crossOrigin:i}));return new Promise((function(e,t){ne(a,"error",t),ne(a,"load",e)}))}(e,{href:o,media:i,crossOrigin:""},function(e,t,n){var r=e.filter((function(e){return e.isMetrum})),o=t.slice(0,t.indexOf(n)).reverse().find((function(e){return r.find(qt(e))})),i=o?r.find(qt(o)).node:null;return!i&&r.length?r[0].node.previousElementSibling:!i&&e.length?e[0].node.previousElementSibling:i}(t,r,a)):Promise.resolve()}function Xt(e,t,n){var r=e.document.createDocumentFragment(),o=n.map((function(n){var o=n.url,i=n.code,a=n.media;if(q(o))return Jt(e,t,{href:o,media:a},zt);if(o){var s=z(e.document,"link",Object.assign({type:"text/css",rel:"stylesheet",crossOrigin:"",href:o},a?{media:a}:{}));return r.appendChild(s),new Promise((function(e,t){s.addEventListener("error",(function(){return t(new Error("Loading external styles failed"))})),s.addEventListener("load",e)}))}return i?(r.appendChild(z(e.document,"style",{textContent:i})),Promise.resolve()):Promise.reject(new Error("Given styles have empty code/href"))}));return e.document.head.appendChild(r),Promise.all(o)}function Kt(e,t,n){if(!t.length)return Promise.resolve();var r=[].concat(m(j(e.document,'link[type="text/css"],style',(function(e){return{href:e.href,code:e.innerHTML,media:e.media,node:e,isMetrum:q(e.href)}})).filter((function(e){var t=e.href,n=e.code;return t||n}))),m(function(e,t,n){var r=[],o=L(e,n.selectors.bundledStylesMap);if(!o)return r;try{return S(ae(o))}catch(e){return t(new Error("Bundled styles map: invalid JSON")),r}}(e.document,It(e),n))),o=Nt(r,t),i=Dt=Dt&&!Dt.forceRefresh?Dt:Yt(e,n,zt),a=i.inject,s=i.isEnabled,c=v(o.reduce((function(e,t){return q(t.url)&&s?(e[0].push(t.url),e):(e[1].push(t),e)}),[[],[]]),2),u=c[0],l=c[1];return Promise.all([Xt(e,r,l),a(u)])}function Qt(e){var t=e.targetWindow,n=e.webResponse,r=e.config,o=n.svgColorMatrixFilters,i=void 0===o?"":o,a=n.assets,s=(a=void 0===a?{}:a).styles,c=void 0===s?[]:s,u=a.prefetches,l=void 0===u?[]:u,d=a.preloads,h=void 0===d?[]:d;return function(e,t){var n=e.document;if(t){var r=L(n,"#svg-color-matrix-filters"),o=L(z(n,"div",{innerHTML:t}),"svg");r?j(o,"filter",(function(e){L(r,"#".concat(W(e,"id")))||r.appendChild(e)})):n.body.insertBefore(o,n.body.firstChild)}}(t,i),h.forEach(_t(t,"preload")),l.forEach(_t(t,"prefetch")),Kt(t,c,r)}function $t(e){var t=e.targetWindow,n=e.webResponse,r=e.lazyScriptsManager,o=e.updateSerializedPropsCollectionCallback,i=n.assets,a=(i=void 0===i?{}:i).scripts,s=v((void 0===a?[]:a).reduce((function(e,t){return t.lazyDownload?e[0].push(t):e[1].push(t),e}),[[],[]]),2),c=s[0];return At(t,s[1],o).then((function(){return r.handleSubtreeAssets(c)}))}var Zt=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,o=e.mountNodeCallback,i=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Qt:u,d=e.injectScripts,h=void 0===d?$t:d,f=e.lazyScriptsManager,p=n.document;function v(e){return L(p,'[data-box-id="'.concat(e,'"]'))}return function(e){var u=e.boxId,d=e.data,m=void 0===d?{}:d,g=e.isPlaceholder,y=m.htmlString,b=void 0===y?"":y,w=m.servicesConfig,E=void 0===w?[]:w,C=m.allowedPlugins,x=void 0===C?[]:C;return i(E),a(x),l({targetWindow:n,webResponse:m,config:t}).then((function(){var e=g?function(e){return L(p,'[data-placeholder-for="'.concat(e,'"]'))}(u):v(u);if(r(e),!b)return e.parentNode.removeChild(e),!1;var t=z(p,"div",{innerHTML:b});return e.parentNode.replaceChild(t.firstElementChild,e),!0})).then((function(e){c(),h({targetWindow:n,webResponse:m,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&o(v(u))}))}))}},en=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,o=e.mountNodeCallback,i=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Qt:u,d=e.injectScripts,h=void 0===d?$t:d,f=e.lazyScriptsManager,p=n.document;function v(e){return L(p,'[data-pathname="'.concat(e,'"]'))}function m(e,t){var n=z(p,"div",{innerHTML:t});return n.setAttribute("data-pathname",e),n}return function(e){var u=e.pathname,d=e.data,g=void 0===d?{}:d,y=g.htmlString,b=void 0===y?"":y,w=g.servicesConfig,E=void 0===w?[]:w,C=g.allowedPlugins,x=void 0===C?[]:C;return i(E),a(x),l({targetWindow:n,webResponse:g,config:t}).then((function(){var e=v(u);if(!e&&b){var t=m(u,b);return p.body.appendChild(t),!0}if(e){if(r(e),!b)return e.parentNode.removeChild(e),!1;var n=m(u,b);return e.parentNode.replaceChild(n,e),!0}return!1})).then((function(e){c(),h({targetWindow:n,webResponse:g,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&o(v(u))}))}))}},tn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e+t},nn=function(){function e(t,n){var r=this;o(this,e),s(this,"observerEntriesHandler",(function(e){e.forEach((function(e){if(e.isIntersecting){var t=e.target.dataset,n=t.civ,o=t.prototypeId,i=r.getDependencyMapEntry(o,n),a=tn(o,n);r.isDownloaded(a)||(r.markAsDownloaded(a),r.unobserveAllUnderKey(a),At(r.targetWindow,i.scripts))}}))})),s(this,"onPrototypeRegistered",(function(e,t){var n=tn(e,t),o=r.unhandledClicks[n];r.registered.push(n),o&&r.reportError(new Error('Lazy scripts: unhandled click(s) registered for "'.concat(e,"@").concat(t,'" before its script was downloaded.')),{unhandledClicksCount:o})})),this.targetWindow=t,this.observedElements={},this.downloaded=[],this.registered=[],this.dependencyMapCache=[],this.observer=null,this.reportError=It(t),this.componentNodesFinder=n,this.unhandledClicks={}}return a(e,[{key:"createObserverInstance",value:function(){this.observer=new this.targetWindow.IntersectionObserver(this.observerEntriesHandler,{rootMargin:"800px",threshold:0})}},{key:"markAsDownloaded",value:function(e){this.downloaded.push(e)}},{key:"isDownloaded",value:function(e){return this.downloaded.includes(e)}},{key:"markAsRegistered",value:function(e){this.registered.push(e)}},{key:"isRegistered",value:function(e){return this.registered.includes(e)}},{key:"observeElement",value:function(e,t){this.observedElements[t]=[].concat(m(this.observedElements[t]||[]),[e]),this.observer.observe(e)}},{key:"unobserveAllUnderKey",value:function(e){var t=this;this.observedElements[e].forEach((function(e){return t.observer.unobserve(e)}))}},{key:"getDependencyMapEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.dependencyMapCache.find((function(n){var r=n.prototypeId,o=n.clientImplementationVersion;return r===e&&(void 0===o?"":o)===t}))}},{key:"addDependencies",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;t.getDependencyMapEntry(n,r)||t.dependencyMapCache.push(e)}))}},{key:"observeComponents",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion,o=t.componentNodesFinder.find(n,r);if(o.length){var i=tn(n,r);o.forEach((function(e){t.observeElement(e,i),t.watchForUnhandledClicks(e,i)}))}else t.reportError(new Error('Lazy scripts: DOM reference not found for "'.concat(n,"@").concat(r,'"')))}))}},{key:"filterDownloadedScripts",value:function(e){var t=this;return e.filter((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;return!t.isDownloaded(tn(n,r))}))}},{key:"watchForUnhandledClicks",value:function(e,t){var n=this;ne(e,"click",(function(){n.isRegistered(t)||(n.unhandledClicks[t]=(n.unhandledClicks[t]||0)+1)}))}},{key:"handleSSRAssets",value:function(){var e=this,t=this.targetWindow.document;ie(t,(function(){e.dependencyMapCache=function(e,t){var n=L(e,'script[data-config="lazy-scripts-map"]'),r=[];if(!n)return r;try{return S(ae(n))}catch(e){return t(new Error("Lazy scripts: incorrect dependency map JSON")),r}}(t,e.reportError),V(e.dependencyMapCache)||(e.createObserverInstance(),e.observeComponents(e.dependencyMapCache))}))}},{key:"handleSubtreeAssets",value:function(e){var t=this,n=this.filterDownloadedScripts(e);if(!V(n)){var r=function(e){return E(e.reduce((function(e,t){var n=t.prototypeId,r=t.clientImplementationVersion,o=tn(n,r),i=e[o];return i?(i.scripts.push(t),e):(e[o]={prototypeId:n,clientImplementationVersion:r,scripts:[t]},e)}),{}))}(n);this.addDependencies(r),this.observer||this.createObserverInstance(),setTimeout((function(){return t.observeComponents(r)}),0)}}}]),e}(),rn=function(){function e(t){o(this,e),this.document=t.document,this.collection=[],this.updateNodesCollection()}return a(e,[{key:"updateNodesCollection",value:function(){this.collection=j(this.document,"div[data-prototype-id]")}},{key:"find",value:function(e,t){return t?this.collection.filter((function(n){return U(n)===e&&_(n)===t})):this.collection.filter((function(t){return U(t)===e}))}}]),e}(),on="data-placeholder-for",an=function(){function e(t,n,r){var i=this;o(this,e),s(this,"domReadyHelper",(function(e){"loading"===i.document.readyState?ie(i.document,e):i.targetWindow.setTimeout(e,0)})),s(this,"lazyloadedElement",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=W(t,on);n&&i.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})})),s(this,"attach",(function(){var e,t,n=de(i.targetWindow),r=i.API;n&&(Mt(n,r,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return he(i.targetWindow,K.apply(void 0,[n,e].concat(r)))})),e=n,t=C(r).concat("initialized","config"),$(e,(function(e){return!t.includes(e)})),Object.freeze(n)),i.broadcastAPILoadEvent(),ne(i.targetWindow,"lazyloaded",i.lazyloadedElement),i.updateInlinePreference(),r.performance.markTimeToInteractive("sc-12453")})),this.targetWindow=t,this.document=t.document;var a=function(e){return de(e).config}(t),c=new fe({targetWindow:t}),u=new ut({targetWindow:t,config:a}),l=new lt({targetWindow:t}),d=It(t),h=new Je({targetWindow:t,config:a,cookieMonsterClient:u,boxViewsMarker:l,reportError:d}),f=new Rt({targetWindow:t,reportError:d}),p=new rn(t),v=new nn(t,p),m=function(e){var t=e.targetWindow,n=e.reportError,r=e.componentNodesFinder,o=new rt(t,n),i=new Ze(Object.assign({},e,{serializedPropsFinder:o}));return{public:Object.assign({init:ot(0,r)},i.createPublicAPI()),private:i.createPrivateAPI()}}({targetWindow:t,services:f,reportError:d,componentNodesFinder:p,registerPrototypeCallback:v.onPrototypeRegistered,unmountNodeCallback:l.unmountNode,mountNodeCallback:l.markBoxAsRendered}),g=new xt({reportError:d,allowedPlugins:a.allowedPlugins}),y={config:a,targetWindow:t,unmountNodeCallback:m.private.unmountNode,mountNodeCallback:m.private.mountNode,updateSerializedPropsCollectionCallback:m.private.updateSerializedPropsCollection,updateComponentNodesCollectionCallback:m.private.updateComponentNodesCollection,updateServicesCallback:f.update,updateAllowedPluginsCallback:g.boundUpdateRegistry,lazyScriptsManager:v},b=new xe({config:a,httpClient:n,reportError:d,boxRenderCallback:Zt(y),fragmentRenderCallback:en(y)}),w=new Pe({appContext:c,analytics:h,updateViewIdCallback:b.updateViewId,updateComponentCallback:m.private.updateComponentCallback,beforeUpdateComponentCallback:m.private.beforeUpdateComponentCallback});this.config=a,this.cookieMonsterClient=u,this.boxViewsMarker=l,this.analytics=h,this.services=f,this.componentAPI=m,this.rawDataListenersRegistry=w,this.opboxWebClient=b,this.plugins=g,this.reportError=d,this.lazyScriptsManager=v,this.navigation=new vt({targetWindow:t,opboxWebClient:b,rawDataListenersRegistry:w,reportError:d}),this.edgeClient=new ct({httpClient:r,edgeHost:a.edgeHost,language:a.language}),this.edgeUploadClient=new ct({httpClient:r,edgeHost:a.edgeUploadHost,language:a.language}),this.preferencesClient=new Ht({edgeClient:this.edgeClient,localStorage:t.localStorage,reportError:d}),this.uiTools=function(e){var t=e.document,n=function(e){return R(e)?L(t,'a[name="'.concat(e,'"]')):null},r=function(n){var r=e.pageYOffset||t.documentElement.scrollTop||0;return n?n.getBoundingClientRect().top+r:null};return{getBoxAnchorNode:n,getTopOffset:r,scrollTo:function(t){var o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).animate,i={duration:void 0===o||o?500:0};if("number"!==A(t)){var a=n(t);if(a){var s=r(a);Et(e,s,i)}}else Et(e,t,i)},tween:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return wt.apply(void 0,[e].concat(n))}}}(t),v.handleSSRAssets(),h.initialize(),this.navigation.initialize(),l.initialize()}return a(e,[{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,plugin:this.plugins.createAPI(),onData:this.rawDataListenersRegistry.registerListener,changeParams:this.navigation.navigateRelative,refreshPage:this.navigation.refreshPage,tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),navigation:this.navigation.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper,loaded:!0,performance:de(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}},{key:"renderBoxForLazyloadedPlaceholders",value:function(){var e=this;k(j(this.document,"[".concat(on,"].lazyloaded")),(function(t){var n=W(t,on);return e.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}))}},{key:"updateInlinePreference",value:function(){var e=this.config,t=this.preferencesClient;e.cssBundle&&e.cssBundle.shouldInline&&t.setPreference("receivedInline",!0)}},{key:"broadcastAPILoadEvent",value:function(){X(this.targetWindow,"opboxAPILoaded")}},{key:"run",value:function(){this.attach(),this.renderBoxForLazyloadedPlaceholders()}}]),e}(),sn=new an(window,le(),le());setTimeout((function(){sn.run()}),0);var cn=sn.attach,un=2e3,ln=6e3;var dn=Object.freeze({__proto__:null,MIN_ENGAGEMENT_DURATION_IN_MS:un,CYCLE_DURATION_IN_MS:ln,attachEngagementObserver:function(e){var t,n=e.targetWindow,r=e.onCycleComplete,o=Date.now,i=o(),a=function(){return n.innerHeight+(n.scrollY||n.document.documentElement.scrollTop)},s=0,c=0,u=a(),l=null,d=!1,h=function(e,t,n){return e.addEventListener(t,n)},f=function(e){if(l){var t;if(l<s){var n=e-s,r=un-(s-l);t=Math.min(n,r)}else{var o=e-l;t=Math.min(o,un)}c+=t}},p=function(){return o()-i},v=function(){d=!1;var e,t=p();f(t),(e=a())>u&&(u=e),l=t},m=function(){var e,t,o;e=p(),f(e),c>0&&r({engagementTime:Math.min(c,ln),scrollBottom:u,pageHeight:(t=n.document,o=t.body,t.documentElement.scrollHeight||o.scrollHeight)}),l<e-un&&(l=null),c=0,s=e,u=a()},g=n.document;h(g,"click",v),h(g,"mousemove",v),h(g,"keydown",v),h(g,"scroll",(function(){d||(d=!0,n.requestAnimationFrame(v))})),h(n,"pagehide",(function(){n.clearInterval(t),m()})),h(n,"pageshow",(function(){s=p(),t=n.setInterval(m,ln)}))}});return e.attach=cn,Object.defineProperty(e,"__esModule",{value:!0}),e}({});