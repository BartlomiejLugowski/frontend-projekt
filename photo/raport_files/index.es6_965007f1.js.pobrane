((e,t)=>{for(var r in t)e[r]=t[r]})(window,(e=>{var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=(e,t,i)=>{r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=(e,t)=>{if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,(t=>e[t]).bind(null,n));return i},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,"a",t),t},r.o=(e,t)=>({}.hasOwnProperty.call(e,t)),r.p="https://assets.allegrostatic.com/sc-17194/",r(r.s=0)})({0(e,t,r){e.exports=r("WdQY")},WdQY(e,t,r){r.r(t);var i=r("rRL6"),n=r.n(i);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let s,a;(e=>{e.DESKTOP="desktop",e.ANDROID="phone-android",e.IPHONE="phone-iphone",e.PHONE="phone",e.ANDROID_APP="mobileapp-android",e.IPHONE_APP="mobileapp-iphone",e.APP="mobileapp",e.TABLET="tablet"})(s||(s={})),(e=>{e.WEB="web",e.MWEB="mweb",e.OTHER="other"})(a||(a={}));const d=e=>{if(e)return e.map(({id:e,name:t,alias:r})=>({id:e,name:t,alias:r}))},u=["1"],p=Error("Failed to render survey");class l{constructor({window:e,api:t,props:r}){o(this,"getSurveyInitiationData",e=>{const t=(e=>{switch(this.props.device){case s.DESKTOP:case s.TABLET:return a.WEB;case s.PHONE:case s.IPHONE:case s.ANDROID:return a.MWEB;default:return a.OTHER}})();return t===a.OTHER?null:{channelName:t,userLocation:{url:this.window.location.toString(),categoryPath:d(this.props.categoryPath)},event:e}}),o(this,"requestSurvey",e=>{this.surveyRequested=!0;const t=this.getSurveyInitiationData(e);t&&this.api.fetchSurveyInitiationData(t).then(e=>{e&&200===e.status&&e.data&&this.showSurvey(e.data.surveyId,e.data.showDelay)})}),o(this,"markPresented",e=>{if(u.includes(e))return;const t=this.getSurveyInitiationData();t&&this.api.markPresented(e,t)}),o(this,"initSurvey",()=>{if(!this.window.document.hidden)return void this.requestSurvey();const e=()=>{"visible"!==document.visibilityState||this.surveyRequested||(this.requestSurvey(),this.window.document.removeEventListener("visibilitychange",e))};this.window.document.addEventListener("visibilitychange",e)}),o(this,"showSurvey",(e,t="0")=>{this.window.opbox.page.render.fragment({pathname:"/ankiety/modal/"+e,additionalQueryParameters:{delay:t}}).catch(()=>{this.window.opbox.reportError(p)})}),o(this,"sendEvent",(e,t)=>{const r=t?{value:t}:void 0;this.requestSurvey({name:e,payload:r})}),this.window=e,this.props=r,this.api=t,this.surveyRequested=!1,this.initSurvey()}getPublicApi(){return{showSurvey:this.showSurvey,sendEvent:this.sendEvent,markPresented:this.markPresented}}}const h={headers:{Accept:"application/vnd.allegro.internal.v1+json","Content-Type":"application/vnd.allegro.internal.v1+json"},withCredentials:!0};class c{constructor({window:e}){o(this,"retries",0),o(this,"fetchSurveyInitiationData",e=>this.window.opbox.edge.post("/survey/search/byLocation",e,h).catch(e=>{this.window.opbox.reportError(e)})),o(this,"markPresented",(e,t)=>this.window.opbox.edge.post(`/survey/${e}/presented/byLocation`,t,h).then(e=>(this.retries=0,e)).catch(r=>{if(this.window.opbox.reportError(r),this.retries+=1,!(this.retries>3))return new Promise(e=>{setTimeout(e,300*this.retries)}).then(()=>this.markPresented(e,t))})),this.window=e}}const{surveyConfiguration:v}=(({pluginName:e,clientImplementationVersion:t})=>{try{return JSON.parse(window.document.querySelector(`script[data-serialize-plugin-name="${e}"][data-civ="${t}"]`).textContent)}catch(r){return window.opbox.reportError(Error(`Missing serialized props of plugin "${e}", with civ "${t}"`)),{}}})({pluginName:"survey",clientImplementationVersion:n.a});if(v&&v.enabled){const e=new c(window);window.opbox.plugin.register({name:"survey"},new l({window,api:e,props:v}).getPublicApi())}},rRL6(e,t){e.exports="73d"}}));
//# sourceMappingURL=index.es6_965007f1.js.map